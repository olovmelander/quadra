<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadra - Meditative Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <svg width="0" height="0" style="position:absolute">
        <defs>
            <filter id="gooey-blobs">
                <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />
                <feBlend in="SourceGraphic" in2="goo" />
            </filter>
        </defs>
    </svg>
    <div class="background-container">
        <canvas id="background-canvas"></canvas>
        <div id="stars"></div>
        
        <div id="forest-theme" class="theme-container">
            <div class="forest-moon"></div>
            <div id="enchanted-forest-back" class="enchanted-forest-layer"></div>
        <div class="forest-mist" id="forest-mist-back"></div>
            <div id="enchanted-forest-mid" class="enchanted-forest-layer"></div>
        <div class="forest-mist" id="forest-mist-front"></div>
            <div id="enchanted-forest-front" class="enchanted-forest-layer"></div>
        </div>
        <div id="ocean-theme" class="theme-container">
            <div class="caustics-container"></div>
            <div class="ocean-water-bg"></div>
            <div id="ocean-plankton-layer"></div>
            <div id="ocean-floor-bg" class="ocean-parallax"></div>
            <div class="ocean-god-rays"></div>
            <div id="ocean-floor-mid" class="ocean-parallax"></div>
            <div id="bubbles"></div>
            <div id="jellyfish-layer"></div>
            <div id="ocean-floor-fg" class="ocean-parallax"></div>
        </div>
        <div id="sunset-theme" class="theme-container">
            <div class="sun-and-sky">
                <div class="sun"></div>
                <div class="lens-flare"></div>
                <div class="sunset-god-rays"></div>
            </div>
            <div id="sunset-clouds-back" class="sunset-clouds"></div>
            <div id="sunset-clouds-mid" class="sunset-clouds"></div>
            <div id="dust-motes"></div>
            <div class="mountain-silhouette"></div>
            <div id="sunset-clouds-front" class="sunset-clouds"></div>
            <div class="sunset-heat-haze"></div>
        </div>
        <div id="mountain-theme" class="theme-container">
            <div class="mountain-sky"></div>
            <div id="mountain-stars"></div>
            <div id="mountain-range-back" class="mountain-range"></div>
            <div class="mountain-clouds"></div>
            <div id="mountain-range-mid" class="mountain-range"></div>
            <div class="mountain-fog"></div>
            <div id="mountain-range-front" class="mountain-range"></div>
        </div>
        <div id="zen-theme" class="theme-container">
            <div class="raked-sand"></div>
            <div class="water-feature">
                <div class="zen-ripple"></div>
            </div>
            <div id="petals"></div>
        </div>
        <div id="winter-theme" class="theme-container">
            <div class="wind-overlay"></div>
            <div id="snowflakes-back" class="snowflakes-layer"></div>
            <div id="snowflakes-mid" class="snowflakes-layer"></div>
            <div id="snowflakes-front" class="snowflakes-layer"></div>
            <div class="window-pane">
                <div class="frost-overlay"></div>
                <div class="ice-crystals"></div>
            </div>
        </div>
        <div id="fall-theme" class="theme-container">
            <div class="fall-bg"></div>
            <div id="fall-wind-particles"></div>
            <div id="fall-leaves-back" class="fall-leaves-layer"></div>
            <div id="fall-leaves-mid" class="fall-leaves-layer"></div>
            <div id="fall-leaves-front" class="fall-leaves-layer"></div>
            <div class="ground-leaves"></div>
        </div>
        <div id="summer-theme" class="theme-container">
            <div class="summer-sky"></div>
            <div class="god-rays-summer"></div>
            <div id="dandelion-seeds"></div>
            <div class="heat-haze"></div>
            <div class="summer-grass"></div>
        </div>
        <div id="spring-theme" class="theme-container">
            <div id="spring-clouds"></div>
            <div id="rainbow-container"></div>
            <div id="spring-rain">
                <div id="rain-back" class="rain-layer"></div>
                <div id="rain-mid" class="rain-layer"></div>
                <div id="rain-front" class="rain-layer"></div>
            </div>
            <div class="spring-ground"></div>
            <div id="sprouts-container"></div>
        </div>
        <div id="aurora-theme" class="theme-container">
            <div id="aurora-stars"></div>
            <div class="aurora-curtain" id="aurora-layer-1"></div>
            <div class="aurora-curtain" id="aurora-layer-2"></div>
            <div class="aurora-curtain" id="aurora-layer-3"></div>
        </div>
        <div id="galaxy-theme" class="theme-container">
            <div id="galaxy-stars-bg"></div>
            <div class="nebula-container">
                <div class="nebula" id="nebula-layer-1"></div>
                <div class="nebula" id="nebula-layer-2"></div>
                <div class="nebula" id="nebula-layer-3"></div>
            </div>
            <div id="shooting-stars"></div>
        </div>
        <div id="rainy-window-theme" class="theme-container">
            <div class="rainy-bg"></div>
            <canvas id="rain-canvas"></canvas>
            <div class="lightning-flash"></div>
        </div>
        <div id="koi-pond-theme" class="theme-container">
            <div class="water-depth-overlay"></div>
            <div class="water-surface"></div>
            <div id="lily-pads"></div>
            <div id="koi-fish"></div>
            <div id="koi-ripples"></div>
        </div>
        <div id="meadow-theme" class="theme-container">
            <div class="meadow-sky"></div>
            <div id="meadow-pollen"></div>
            <div id="meadow-butterflies"></div>
            <div class="meadow-grass"></div>
            <div id="meadow-flowers"></div>
        </div>
        <div id="cosmic-chimes-theme" class="theme-container">
            <div class="chime-nebula"></div>
            <div id="space-dust"></div>
            <div id="chimes"></div>
        </div>
        <div id="singing-bowl-theme" class="theme-container">
            <div id="singing-bowl-glow"></div>
            <div class="singing-bowl-silhouette"></div>
            <div id="bowl-ripples"></div>
            <div id="bowl-motes"></div>
        </div>
        <div id="starlight-theme" class="theme-container">
            <div id="starlight-nebula"></div>
            <div id="starlights-back" class="starlight-layer"></div>
            <div id="starlights-mid" class="starlight-layer"></div>
            <div id="starlights-front" class="starlight-layer"></div>
            <div id="starlight-shooting-stars"></div>
        </div>
        <div id="geode-theme" class="theme-container">
            <div id="geode-dust-back"></div>
            <div id="geode-crystals"></div>
            <div id="geode-dust-mid"></div>
            <div id="geode-dust-front"></div>
        </div>
        <div id="bioluminescence-theme" class="theme-container">
            <div id="bio-mushrooms"></div>
            <div id="bio-spores"></div>
        </div>
        <div id="swedish-forest-theme" class="theme-container">
            <div id="sf-layer-1" class="sf-parallax"></div>
            <div class="god-ray-container"></div>
            <div id="sf-layer-2" class="sf-parallax"></div>
            <div class="mist"></div>
            <div id="sf-layer-3" class="sf-parallax"></div>
            <div id="forest-spirits"></div>
        </div>
        <div id="desert-oasis-theme" class="theme-container">
            <div class="desert-sky"></div>
            <div id="desert-stars"></div>
            <div id="desert-dunes-back" class="desert-dunes"></div>
            <div id="desert-dunes-mid" class="desert-dunes"></div>
            <div id="desert-rocks"></div>
            <div class="desert-mirage"></div>
            <div id="desert-sand-particles"></div>
            <div id="desert-fauna"></div>
            <div id="desert-dunes-front" class="desert-dunes"></div>
            <div id="desert-flora"></div>
        </div>
        <div id="bamboo-grove-theme" class="theme-container">
            <div class="bamboo-sky"></div>
            <div id="bamboo-grove-back" class="bamboo-grove"></div>
            <div id="bamboo-sun-dapples"></div>
            <div id="bamboo-grove-mid" class="bamboo-grove"></div>
            <div id="bamboo-leaves"></div>
            <div id="bamboo-fauna"></div>
            <div id="bamboo-grove-front" class="bamboo-grove"></div>
            <div id="bamboo-path"></div>
            <div id="bamboo-lantern"></div>
            <div class="bamboo-mist"></div>
        </div>
        <div id="misty-lake-theme" class="theme-container">
            <div class="misty-sky"></div>
            <div id="misty-lake-reflection"></div>
            <div id="misty-mountains-back" class="misty-mountains"></div>
            <div id="misty-mountains-mid" class="misty-mountains"></div>
            <div id="misty-mountains-front" class="misty-mountains"></div>
            <div id="misty-lake-surface"></div>
            <div id="misty-lake-mist"></div>
            <div id="misty-lake-fauna"></div>
            <div id="misty-lake-flora"></div>
        </div>
        <div id="waves-theme" class="theme-container">
            <div class="waves-bg"></div>
            <div id="waves-particles"></div>
            <div id="waves-layer-back" class="wave-layer"></div>
            <div id="waves-layer-mid" class="wave-layer"></div>
            <div id="waves-layer-front" class="wave-layer"></div>
        </div>
        <div id="fluid-dreams-theme" class="theme-container">
            <div id="liquid-mercury"></div>
            <div id="morphing-blobs"></div>
            <div id="iridescent-bubbles"></div>
            <div id="ribbon-streams"></div>
            <div class="dimensional-warp"></div>
        </div>
        <div id="lantern-festival-theme" class="theme-container">
            <div class="lantern-sky"></div>
            <div id="lantern-mountains"></div>
            <div id="lantern-silhouettes"></div>
            <div id="lanterns-back" class="lantern-layer"></div>
            <div id="lanterns-mid" class="lantern-layer"></div>
            <div id="lanterns-front" class="lantern-layer"></div>
            <div id="lantern-petals"></div>
            <div id="lantern-embers"></div>
            <div id="lantern-water"></div>
        </div>
        <div id="crystal-cave-theme" class="theme-container">
            <div id="crystal-cave-refractions"></div>
            <div id="crystal-cave-pools"></div>
            <div id="crystal-cave-moss"></div>
            <div id="crystal-cave-glow-clusters"></div>
        </div>
        <div id="candlelit-monastery-theme" class="theme-container">
            <div id="monastery-shadows"></div>
            <div id="monastery-stained-glass-light"></div>
            <div id="monastery-candles"></div>
            <div id="monastery-benches"></div>
        </div>
        <div id="cherry-blossom-garden-theme" class="theme-container">
            <div id="cherry-blossom-sky"></div>
            <div id="cherry-blossom-sun"></div>
            <div id="cherry-blossom-clouds"></div>
            <div id="cherry-blossom-hills"></div>
            <div id="cherry-blossom-haze"></div>
            <div id="cherry-blossom-branches"></div>
            <div id="cherry-blossom-leaves"></div>
            <div id="cherry-blossom-ground"></div>
        </div>
        <div id="floating-islands-theme" class="theme-container">
            <div id="floating-islands-sky"></div>
            <div id="floating-islands-clouds"></div>
            <div id="floating-aurora"></div>
            <div id="floating-islands-back" class="floating-island-layer"></div>
            <div id="floating-islands-mid" class="floating-island-layer"></div>
            <div id="floating-islands-front" class="floating-island-layer"></div>
        </div>
        <div id="meditation-temple-theme" class="theme-container">
            <div id="meditation-temple-sky"></div>
            <div id="meditation-temple-mountains-back" class="meditation-temple-mountain-layer"></div>
            <div id="meditation-temple-mountains-mid" class="meditation-temple-mountain-layer"></div>
            <div id="meditation-temple-main"></div>
            <div id="meditation-temple-trees"></div>
            <div id="meditation-temple-prayer-flags"></div>
            <div id="meditation-temple-incense"></div>
            <div id="meditation-temple-mountains-front" class="meditation-temple-mountain-layer"></div>
        </div>
        <div id="moonlit-greenhouse-theme" class="theme-container">
            <div id="greenhouse-sky"></div>
            <div id="greenhouse-moon"></div>
            <div id="greenhouse-mist"></div>
            <div id="greenhouse-plants-back" class="greenhouse-plant-layer"></div>
            <div id="greenhouse-framework"></div>
            <div id="greenhouse-plants-mid" class="greenhouse-plant-layer"></div>
            <div id="greenhouse-dewdrops"></div>
            <div id="greenhouse-plants-front" class="greenhouse-plant-layer"></div>
            <div id="greenhouse-moths"></div>
        </div>
        <div id="ice-temple-theme" class="theme-container">
            <div id="ice-temple-sky"></div>
            <div id="ice-temple-aurora"></div>
            <div id="ice-temple-refractions"></div>
            <div id="ice-temple-waterfalls"></div>
            <div id="ice-temple-sculptures"></div>
        </div>
        <div id="himalayan-peak-theme" class="theme-container">
            <div id="himalayan-sky"></div>
            <div id="himalayan-sun"></div>
            <div id="himalayan-sun-rays"></div>
            <div id="himalayan-clouds"></div>
            <div id="himalayan-flags"></div>
            <div id="himalayan-particles"></div>
        </div>
    </div>

    <div class="game-container">
        <div class="sidebar">
            <div class="panel">
                <h2>STATS</h2>
                <div class="stat-row"><span class="stat-label">SCORE</span><span id="score" class="stat-value">0</span></div>
                <div class="stat-row"><span class="stat-label">LINES</span><span id="lines" class="stat-value">0</span></div>
                <div class="stat-row"><span class="stat-label">LEVEL</span><span id="level" class="stat-value">1</span></div>
                <div class="stat-row"><span class="stat-label">NEXT LVL</span><span id="next-level" class="stat-value">10</span></div>
                <div class="stat-row"><span class="stat-label">SPEED</span><span id="speed" class="stat-value">1.0x</span></div>
                <div class="stat-row"><span class="stat-label">BPM</span><span id="bpm" class="stat-value">0</span></div>
            </div>
            <div class="panel">
                <h2>CONTROLS</h2>
                <div class="controls-info"><div id="controls-list"></div></div>
            </div>
            <button id="sound-toggle" class="action-btn">🔊</button>
            <button id="next-track-btn" class="action-btn">🎵</button>
            <button id="fullscreen-toggle" class="action-btn">⛶</button>
            <button id="settings-btn" class="action-btn">⚙️</button>
        </div>
        <div class="game-area">
            <div class="next-pieces-container">
                <div class="next-piece-box main"><span class="next-piece-label">Next</span><canvas id="next-0" width="60" height="50"></canvas></div>
                <div class="next-piece-box"><canvas id="next-1" width="50" height="40"></canvas></div>
                <div class="next-piece-box"><canvas id="next-2" width="50" height="40"></canvas></div>
                <div class="next-piece-box"><canvas id="next-3" width="50" height="40"></canvas></div>
                <div class="next-piece-box"><canvas id="next-4" width="50" height="40"></canvas></div>
            </div>
            <div style="position: relative;">
                <canvas id="game-canvas"></canvas>
                <div id="score-popups"></div>
            </div>
        </div>
    </div>

    <div id="start-modal" class="modal visible">
        <div class="modal-content">
            <h1>QUADRA</h1>
            <p>Press any key or tap to start</p>
        </div>
    </div>
    <div id="game-over-modal" class="modal">
        <div class="modal-content">
            <h1>The cycle ends.</h1>
            <div id="final-stats"></div>
            <p>Press any key or tap to restart</p>
        </div>
    </div>
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <h1>SETTINGS</h1>
            <div class="settings-scroll-container">
                <div class="settings-grid">
                    <div class="setting">
                        <label for="das-delay">DAS Delay (ms):</label>
                        <div class="slider-container">
                            <input type="range" id="das-delay" min="50" max="300" step="10"><span id="das-delay-value">150</span>
                        </div>
                    </div>
                    <div class="setting">
                        <label for="das-interval">DAS Interval (ms):</label>
                        <div class="slider-container">
                            <input type="range" id="das-interval" min="10" max="100" step="5"><span id="das-interval-value">50</span>
                        </div>
                    </div>
                    <div class="setting">
                        <label for="music-track">Music Track:</label>
                        <select id="music-track" class="setting-select">
                            <option value="Ambient">Ambient (Relax)</option>
                            <option value="Decay">Decay (Meditate)</option>
                            <option value="Zen">Zen (Calm)</option>
                            <option value="Nostalgia">Nostalgia (Focus)</option>
                            <option value="Nebula">Nebula (Modern)</option>
                            <option value="Aurora">Aurora</option>
                            <option value="Galaxy">Galaxy</option>
                            <option value="Rainfall">Rainfall</option>
                            <option value="Koi">Koi</option>
                            <option value="Meadow">Meadow</option>
                            <option value="MiracleTone">Miracle Tone (528Hz)</option>
                            <option value="HealingDrone">Healing Drone (174Hz)</option>
                            <option value="CosmicChimes">Cosmic Chimes (Ethereal)</option>
                            <option value="SingingBowl">Singing Bowl (Deep)</option>
                            <option value="Starlight">Starlight (Gentle)</option>
                            <option value="SwedishForest">Swedish Forest (Deep)</option>
                            <option value="GongBath">Gong Bath (Immersive)</option>
                            <option value="BreathOfStillness">Breath of Stillness (Relax)</option>
                            <option value="SacredJourney">Sacred Journey (Meditate)</option>
                            <option value="ReturnToLight">Return to Light (Healing)</option>
                        </select>
                    </div>
                    <div class="setting">
                        <label for="sfx-set">Sound Effects:</label>
                        <select id="sfx-set" class="setting-select">
                            <option value="Zen">Zen</option>
                            <option value="Retro">Retro</option>
                        </select>
                    </div>
                     <div class="setting">
                        <label for="background-mode">Background:</label>
                        <select id="background-mode" class="setting-select">
                            <option value="Level">Level Transition</option>
                            <option value="Random">Random Transition</option>
                            <option value="Specific">Set Specific</option>
                        </select>
                    </div>
                    <div class="setting" id="theme-setting">
                        <label for="background-theme">Theme:</label>
                        <select id="background-theme" class="setting-select">
                            <option value="forest">Forest</option>
                            <option value="ocean">Ocean</option>
                            <option value="sunset">Sunset</option>
                            <option value="mountain">Mountain</option>
                            <option value="zen">Zen</option>
                            <option value="winter">Winter</option>
                            <option value="fall">Fall</option>
                            <option value="summer">Summer</option>
                            <option value="spring">Spring</option>
                            <option value="aurora">Aurora</option>
                            <option value="galaxy">Galaxy</option>
                            <option value="rainy-window">Rainy Window</option>
                            <option value="koi-pond">Koi Pond</option>
                            <option value="meadow">Meadow</option>
                            <option value="cosmic-chimes">Cosmic Chimes</option>
                            <option value="singing-bowl">Singing Bowl</option>
                            <option value="starlight">Starlight</option>
                            <option value="swedish-forest">Swedish Forest</option>
                            <option value="geode">Geode</option>
                            <option value="bioluminescence">Bioluminescence</option>
                            <option value="desert-oasis">Desert Oasis</option>
                            <option value="bamboo-grove">Bamboo Grove</option>
                            <option value="misty-lake">Misty Mountain Lake</option>
                            <option value="waves">Waves</option>
                            <option value="fluid-dreams">Fluid Dreams</option>
                            <option value="lantern-festival">Lantern Festival</option>
                            <option value="crystal-cave">Crystal Cave</option>
                            <option value="candlelit-monastery">Candlelit Monastery</option>
                            <option value="cherry-blossom-garden">Cherry Blossom Garden</option>
                            <option value="floating-islands">Floating Islands</option>
                            <option value="meditation-temple">Meditation Temple</option>
                            <option value="moonlit-greenhouse">Moonlit Greenhouse</option>
                            <option value="ice-temple">Ice Temple</option>
                            <option value="himalayan-peak">Himalayan Peak</option>
                        </select>
                    </div>
                    <div class="setting"><label>Move Left:</label> <div id="key-moveLeft" class="key-input" tabindex="0">ArrowLeft</div></div>
                    <div class="setting"><label>Move Right:</label> <div id="key-moveRight" class="key-input" tabindex="0">ArrowRight</div></div>
                    <div class="setting"><label>Rotate Right:</label> <div id="key-rotateRight" class="key-input" tabindex="0">ArrowUp</div></div>
                    <div class="setting"><label>Rotate Left:</label> <div id="key-rotateLeft" class="key-input" tabindex="0">z</div></div>
                    <div class="setting"><label>Flip (180°):</label> <div id="key-flip" class="key-input" tabindex="0">a</div></div>
                    <div class="setting"><label>Soft Drop:</label> <div id="key-softDrop" class="key-input" tabindex="0">ArrowDown</div></div>
                    <div class="setting"><label>Hard Drop:</label> <div id="key-hardDrop" class="key-input" tabindex="0">Space</div></div>
                    <div class="setting"><label>Toggle Music:</label> <div id="key-toggleMusic" class="key-input" tabindex="0">M</div></div>
                    <div class="setting">
                        <label for="control-scheme">Controls:</label>
                        <select id="control-scheme" class="setting-select">
                            <option value="Keyboard">Keyboard</option>
                            <option value="Touch">Touch</option>
                        </select>
                    </div>
                </div>
            </div>
            <button id="close-settings" class="action-btn">Close</button>
        </div>
    </div>
    <script src="renderer.js"></script>
    <script src="script.js"></script>
</body>
</html>

