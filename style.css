        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Mono', monospace;
            background-color: #0c0a1a;
            min-height: 100dvh; /* Use dynamic viewport height */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* --- Background Container --- */
        .background-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        #background-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Below theme containers */
            pointer-events: none;
        }

.theme-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    visibility: hidden;
    transition: opacity 2.5s ease-in-out, visibility 0s linear 2.5s; /* Fade out, then hide */
    will-change: opacity, visibility; /* Optimization for browsers */
}

.theme-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 6; /* Position it with other particles */
    pointer-events: none; /* Make sure it doesn't block interactions */
}

.theme-container.active {
    opacity: 1;
    visibility: visible;
    transition: opacity 2.5s ease-in-out; /* Fade in */
}

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 5s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.5; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1); }
        }

        /* --- Forest Theme --- */
        #forest-theme {
            background: linear-gradient(to top, #0a0e1a, #1a223a, #2a3a5a);
            overflow: hidden;
        }
        .enchanted-forest-layer {
            position: absolute;
            bottom: 0; left: 0;
            width: 200%; height: 100%;
            will-change: transform;
        }
        #enchanted-forest-back { animation: slide 280s linear infinite; z-index: 1; filter: brightness(0.6); }
        #enchanted-forest-mid { animation: slide 200s linear infinite; z-index: 4; filter: brightness(0.8); }
        #enchanted-forest-front { animation: slide 120s linear infinite; z-index: 7; }

        .forest-moon {
            position: absolute;
            top: 10%; left: 0;
            width: 80px; height: 80px;
            background: radial-gradient(circle, #f0f0f0, #d0d0e0);
            border-radius: 50%;
            box-shadow: 0 0 40px #d0d0e0, 0 0 80px #f0f0f0;
            animation: moon-path 180s linear infinite;
            z-index: 2;
        }
        @keyframes moon-path {
            from { transform: translate(-10vw, 0); }
            to { transform: translate(110vw, 20vh); }
        }

        #forest-mist-back {
            z-index: 3;
            opacity: 0.7;
            animation: mist-scroll 180s linear infinite;
            filter: brightness(0.9);
        }
        #forest-mist-front {
            z-index: 5;
            opacity: 1;
            animation: mist-scroll 100s linear infinite;
            transform: translateY(10%);
        }

        .forest-particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(200, 220, 255, 0.3);
            animation: float-particle linear infinite;
            z-index: 6; /* Positioned with fireflies */
        }

        @keyframes float-particle {
            0% {
                transform: translate(var(--x-start), var(--y-start)) scale(1);
                opacity: 0;
            }
            20%, 80% {
                opacity: 0.8;
            }
            100% {
                transform: translate(var(--x-end), var(--y-end)) scale(0.5);
                opacity: 0;
            }
        }

        .wind-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="1000"><filter id="wind"><feTurbulence type="fractalNoise" baseFrequency="0.02 0.005" numOctaves="2" seed="2" result="turbulence"/><feDisplacementMap in="SourceGraphic" in2="turbulence" scale="30" xChannelSelector="R" yChannelSelector="G"/></filter><rect width="1000" height="1000" fill="transparent"><animate attributeName="fill" values="rgba(255,255,255,0.0);rgba(255,255,255,0.03);rgba(255,255,255,0.0);" dur="8s" repeatCount="indefinite"/></rect><rect width="1000" height="1000" fill="rgba(255,255,255,0.03)" filter="url(%23wind)"/></svg>');
            background-size: 150% 150%;
            animation: wind-pan 15s linear infinite alternate;
            opacity: 0.5;
            z-index: 4; /* Between mid and front snow layers */
        }
        @keyframes wind-pan {
            from { background-position: 0% 0%; }
            to { background-position: 100% 100%; }
        }

        .firefly {
            position: absolute;
            width: 5px; height: 5px;
            background-color: #f0f0aa;
            border-radius: 50%;
            box-shadow: 0 0 12px #f0f0aa, 0 0 20px #f0f0aa;
            animation: fly-enchanted 15s ease-in-out infinite;
            z-index: 6;
        }
        @keyframes fly-enchanted {
            0%, 100% {
                transform: translate(var(--x-start), var(--y-start)) scale(0.8);
                opacity: 0.5;
            }
            50% {
                transform: translate(var(--x-end), var(--y-end)) scale(1.2);
                opacity: 1;
            }
        }

        /* --- Ocean Theme --- */
        #ocean-theme {
            overflow: hidden;
        }
        .ocean-water-bg {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(to top, #010810, #021B39, #0A4882);
            z-index: 2;
        }
        .ocean-parallax {
            position: absolute;
            bottom: 0; left: 0;
            width: 200%; height: 100%;
            will-change: transform;
        }
        #ocean-floor-bg { animation: slide 320s linear infinite; z-index: 4; filter: brightness(0.7); }
        #ocean-floor-mid { animation: slide 240s linear infinite; z-index: 6; filter: brightness(0.85); }
        #ocean-floor-fg { animation: slide 160s linear infinite; z-index: 9; }

        .ocean-god-rays {
            position: absolute; top: -10%; left: -10%;
            width: 120%; height: 120%;
            transform-origin: center;
            animation: ocean-ray-anim 90s ease-in-out infinite alternate;
            z-index: 5;
        }
        .ocean-god-ray {
            position: absolute; top: 0;
            background: linear-gradient(to bottom, rgba(173, 216, 230, 0.15) 0%, rgba(173, 216, 230, 0) 70%);
            transform-origin: top center;
        }
        @keyframes ocean-ray-anim {
            from { transform: rotate(-20deg); }
            to { transform: rotate(20deg); }
        }

        .caustics-container {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            transform-origin: center;
            animation: slow-pan 120s linear infinite alternate;
            z-index: 1;
            mix-blend-mode: screen;
        }
        @keyframes slow-pan {
            from { transform: translateX(-5%) scale(1.1); }
            to { transform: translateX(5%) scale(1.1); }
        }
        .caustic-light {
            position: absolute;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><filter id="w"><feTurbulence type="fractalNoise" baseFrequency="0.015" numOctaves="4" seed="8"/><feDiffuseLighting in="w" lighting-color="white" surfaceScale="8"><feDistantLight azimuth="45" elevation="50"/></feDiffuseLighting></filter><rect width="300" height="300" fill="rgba(200,225,255,0.1)" filter="url(%23w)"/></svg>');
            background-size: 300% 300%;
            width: 100%; height: 100%;
            animation: caustics-anim 25s ease-in-out infinite alternate;
        }
        @keyframes caustics-anim {
            from { background-position: 0% 0%; }
            to { background-position: 100% 100%; }
        }

        #jellyfish-layer { z-index: 8; }
        .jellyfish {
            position: absolute;
            animation: swim-jellyfish 20s ease-in-out infinite;
        }
        .jelly-body {
            width: 50px; height: 30px;
            background: radial-gradient(ellipse at top, rgba(100, 200, 255, 0.7), rgba(50, 150, 255, 0.3));
            border-radius: 50% 50% 20% 20%;
            animation: pulse-jelly 4s ease-in-out infinite;
        }
        .jelly-tentacles {
            position: absolute; top: 25px; left: 25px;
        }
        .tentacle {
            position: absolute;
            width: 2px;
            background: linear-gradient(to bottom, rgba(100, 200, 255, 0.6), transparent);
            animation: wave-tentacle 4s ease-in-out infinite;
        }
        @keyframes swim-jellyfish {
            from { transform: translate(var(--x-start), var(--y-start)) rotate(-10deg); }
            to { transform: translate(var(--x-end), var(--y-end)) rotate(10deg); }
        }
        @keyframes pulse-jelly {
            0%, 100% { transform: scale(1, 1); }
            50% { transform: scale(1.1, 0.9); }
        }
        @keyframes wave-tentacle {
            0%, 100% { transform: rotate(-10deg) scaleY(1); }
            50% { transform: rotate(10deg) scaleY(1.2); }
        }

        #ocean-plankton-layer { z-index: 3; }
        .ocean-plankton {
            position: absolute;
            background: rgba(173, 216, 230, 0.7);
            border-radius: 50%;
            animation: drift-plankton 10s ease-in-out infinite alternate;
        }
        @keyframes drift-plankton {
            from {
                transform: translate(var(--x-start), var(--y-start));
                opacity: 0;
            }
            50% { opacity: 0.5; }
            to {
                transform: translate(var(--x-end), var(--y-end));
                opacity: 0;
            }
        }

        #bubbles { z-index: 7; }
        .bubble {
            position: absolute;
            background: rgba(173, 216, 230, 0.15);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 50%;
            animation: rise-deep ease-in-out infinite;
        }
        @keyframes rise-deep {
            0% {
                bottom: -20px;
                transform: translateX(0) scale(1);
                opacity: 0.8;
            }
            25% {
                transform: translateX(calc(var(--x-drift) * 0.5)) scale(1.1);
            }
            50% {
                transform: translateX(var(--x-drift)) scale(1.05);
            }
            75% {
                 transform: translateX(calc(var(--x-drift) * 1.2)) scale(1.1);
            }
            99% {
                opacity: 0.1;
            }
            100% {
                bottom: 105vh;
                transform: translateX(var(--x-drift-end)) scale(0.8);
                opacity: 0;
            }
        }

        /* --- Sunset Theme --- */
        #sunset-theme {
            overflow: hidden;
        }
        .sun-and-sky {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            animation: sky-color-change 150s ease-in-out infinite;
            z-index: 1;
        }
        @keyframes sky-color-change {
            0% { background: linear-gradient(to top, #6DD5FA, #2980B9); } /* Daytime Blue */
            25% { background: linear-gradient(to top, #F7B733, #FC4A1A); } /* Golden Hour */
            50% { background: linear-gradient(to top, #EC008C, #FC6767); } /* Vibrant Sunset */
            75% { background: linear-gradient(to top, #485563, #29323C); } /* Twilight */
            100% { background: linear-gradient(to top, #0C1440, #000000); } /* Night */
        }
        .sun {
            position: absolute;
            top: 50%; left: 50%;
            width: 150px; height: 150px;
            background: radial-gradient(circle, #fff, #ffd700, #ff8c00);
            border-radius: 50%;
            animation: sunset-path 150s ease-in-out infinite, sun-pulse 8s ease-in-out infinite;
        }
        @keyframes sun-pulse {
            from { box-shadow: 0 0 70px #ff8c00, 0 0 140px #ffd700; }
            to { box-shadow: 0 0 90px #ff8c00, 0 0 180px #ffd700; }
        }
        @keyframes sunset-path {
            0% { transform: translate(-50%, -20vh) scale(1.1); }
            50% { transform: translate(-50%, 50vh) scale(1); }
            100% { transform: translate(-50%, 110vh) scale(0.6); }
        }
        .lens-flare {
            position: absolute;
            top: 50%; left: 50%;
            width: 400px; height: 400px;
            background: radial-gradient(circle, rgba(255,255,220,0.2) 0%, rgba(255,255,220,0) 40%);
            border-radius: 50%;
            animation: sunset-path 150s ease-in-out infinite; /* Same as sun */
            opacity: 0;
            animation-name: sunset-path, lens-flare-fade;
        }
        @keyframes lens-flare-fade {
            0% { opacity: 0.8; }
            50% { opacity: 0.5; }
            100% { opacity: 0; }
        }
        .sunset-clouds {
            position: absolute;
            top: 0; left: 0;
            width: 200%; height: 100%;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            will-change: transform;
        }
        #sunset-clouds-back { animation-name: slide-sunset; animation-duration: 280s; z-index: 2; opacity: 0.4; }
        #sunset-clouds-mid { animation-name: slide-sunset; animation-duration: 200s; animation-direction: reverse; z-index: 4; opacity: 0.6; }
        #sunset-clouds-front { animation-name: slide-sunset; animation-duration: 120s; z-index: 6; opacity: 0.8; }
        @keyframes slide-sunset {
            from { transform: translateX(0%); }
            to { transform: translateX(-50%); }
        }

        .sunset-god-rays {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 3;
            animation: sunset-path 150s ease-in-out infinite, sunset-ray-fade 150s linear infinite;
            transform-origin: 50% 0;
        }
        .sunset-god-ray {
            position: absolute;
            top: -10%; left: 50%;
            width: 2px;
            height: 120%;
            background: linear-gradient(to bottom, rgba(255, 220, 180, 0.25), transparent);
            transform-origin: top center;
        }
        @keyframes sunset-ray-fade {
            0% { opacity: 1; }
            40% { opacity: 1; }
            80% { opacity: 0; }
            100% { opacity: 0; }
        }
        .mountain-silhouette {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 25%;
            z-index: 5;
        }
        .sunset-heat-haze {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="haze"><feTurbulence type="turbulence" baseFrequency="0.01 0.03" numOctaves="1" result="turbulence"/><feDisplacementMap in2="turbulence" in="SourceGraphic" scale="3" xChannelSelector="R" yChannelSelector="G"/></filter><rect width="200" height="200" fill="transparent" filter="url(%23haze)"/></svg>');
            background-size: 200px 200px;
            animation: heat-haze-anim 8s linear infinite alternate;
            opacity: 0;
            z-index: 10;
        }
        @keyframes heat-haze-anim {
            0% { background-position: 0% 0%; opacity: 0; }
            40% { opacity: 0.1; }
            60% { opacity: 0.1; }
            100% { background-position: 100% 100%; opacity: 0; }
        }

        .dust-mote {
            position: absolute;
            background: rgba(255, 220, 180, 0.7);
            border-radius: 50%;
            animation: mote-drift 15s ease-in-out infinite alternate;
            z-index: 3;
        }
        @keyframes mote-drift {
            from {
                transform: translate(var(--x-start), var(--y-start));
                opacity: 0;
            }
            50% {
                opacity: 0.8;
            }
            to {
                transform: translate(var(--x-end), var(--y-end));
                opacity: 0;
            }
        }

        /* --- Mountain Theme --- */
        #mountain-theme {
            background: linear-gradient(to bottom, #87CEEB 0%, #F0E68C 100%);
            overflow: hidden;
        }
        .mountain-sky {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(to bottom, #2c3e50, #4a69bd, #f7b733, #e67e22);
            animation: mountain-sky-cycle 240s linear infinite;
            z-index: 1;
        }
        @keyframes mountain-sky-cycle {
            0% { background: linear-gradient(to bottom, #141E30, #243B55); } /* Night */
            25% { background: linear-gradient(to bottom, #764BA2, #667EEA); } /* Dawn */
            50% { background: linear-gradient(to bottom, #87CEEB, #FFFFFF); } /* Day */
            75% { background: linear-gradient(to bottom, #F7B733, #FC4A1A); } /* Dusk */
            100% { background: linear-gradient(to bottom, #141E30, #243B55); } /* Night */
        }
        .mountain-range {
            position: absolute;
            bottom: 0; left: 0;
            width: 200%; height: 100%;
            animation: slide-mountain linear infinite;
            will-change: transform;
        }
        #mountain-range-back { animation-duration: 400s; z-index: 2; filter: brightness(0.6); }
        #mountain-range-mid { animation-duration: 280s; z-index: 4; filter: brightness(0.8); }
        #mountain-range-front { animation-duration: 160s; z-index: 6; }

        .mountain-clouds {
            position: absolute; top: 10%; left: 0;
            width: 200%; height: 30%;
            animation: slide-mountain 100s linear infinite reverse;
            z-index: 3;
        }
        .mountain-fog {
            position: absolute; bottom: 0; left: 0;
            width: 200%; height: 20%;
            background: linear-gradient(to top, rgba(180, 190, 200, 0.25) 0%, transparent 100%);
            animation: slide-mountain 80s linear infinite;
            z-index: 5;
        }

        .mountain-star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle-mountain 10s ease-in-out infinite;
            opacity: 0;
        }
        @keyframes twinkle-mountain {
            0%, 100% { opacity: var(--start-op); }
            50% { opacity: var(--end-op); }
        }

        @keyframes slide-mountain {
            from { transform: translateX(0%); }
            to { transform: translateX(-50%); }
        }

        /* --- Zen Theme --- */
        #zen-theme {
            background-color: #d8c8b8;
            overflow: hidden;
        }
        .raked-sand {
            position: absolute;
            width: 100%; height: 100%;
            background-image:
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(0,0,0,0.02) 35px, rgba(0,0,0,0.02) 70px),
                repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(0,0,0,0.02) 35px, rgba(0,0,0,0.02) 70px);
            filter: blur(1px);
        }
        .water-feature {
            position: absolute;
            bottom: 2%; right: 2%;
            width: 25%; height: 20%;
            background-color: #3a4a5a;
            border-radius: 45% 55% 40% 60% / 60% 50% 50% 40%;
            overflow: hidden;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
        }
        .zen-ripple {
            position: absolute;
            top: 50%; left: 50%;
            border: 1px solid rgba(200, 220, 240, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: zen-ripple-effect 6s ease-out;
        }
        @keyframes zen-ripple-effect {
            from { width: 0; height: 0; opacity: 1; }
            to { width: 250px; height: 250px; opacity: 0; }
        }

        .petal {
            position: absolute;
            width: 18px; height: 18px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 0 C5 5, 5 15, 10 20 C15 15, 15 5, 10 0 Z" fill="rgba(255, 105, 180, 0.8)"/></svg>');
            background-size: contain;
            animation: fall-petal-zen linear infinite;
            z-index: 10;
        }
        @keyframes fall-petal-zen {
            0% {
                transform: translateY(-10vh) translateX(0) rotate(var(--r-start));
                opacity: 1;
            }
             25% {
                transform: translateY(25vh) translateX(calc(var(--x-drift) * 0.4)) rotate(calc(var(--r-start) + 180deg));
            }
            50% {
                transform: translateY(50vh) translateX(calc(var(--x-drift) * 0.8)) rotate(calc(var(--r-start) + 360deg));
            }
            75% {
                 transform: translateY(80vh) translateX(calc(var(--x-drift) * 1.1)) rotate(calc(var(--r-start) + 540deg));
            }
            100% {
                transform: translateY(110vh) translateX(var(--x-drift)) rotate(var(--r-end));
                opacity: 0;
            }
        }

        /* --- Winter Theme --- */
        #winter-theme {
            background: linear-gradient(to top, #e0e8f0, #a0b0c0, #607080);
            overflow: hidden;
        }
        .snowflakes-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
        }
        #snowflakes-back { z-index: 1; transform: scale(0.6); filter: blur(3px) brightness(0.7); }
        #snowflakes-mid { z-index: 3; transform: scale(0.8); filter: blur(1px); }
        #snowflakes-front { z-index: 5; transform: scale(1.1); filter: brightness(1.1); }

        .snowflake {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: fall-snow-swirl linear infinite;
        }
        @keyframes fall-snow-swirl {
             0% {
                transform: translateY(-10vh) translateX(var(--x-start)) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
             100% {
                transform: translateY(110vh) translateX(var(--x-end)) rotate(var(--r-end));
                opacity: 0;
            }
        }

        .window-pane {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        .frost-overlay {
            width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 60%, rgba(255,255,255,0.1));
            box-shadow: inset 0 0 80px rgba(230,240,255,0.3);
        }
        .ice-crystal {
            position: absolute;
            width: 120px; height: 120px;
            background-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 0 20px white, 0 0 35px white;
            animation: form-crystal 30s ease-out infinite;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            filter: blur(0.5px);
        }

        @keyframes form-crystal {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            80% {
                transform: scale(1) rotate(72deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(1.1) rotate(90deg);
                opacity: 0;
            }
        }

        /* --- Fall Theme --- */
        #fall-theme {
            background: linear-gradient(to top, #a26e49, #c88c53, #f7b267);
            overflow: hidden;
        }
        .fall-bg {
            position: absolute; width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><filter id="f"><feGaussianBlur stdDeviation="3"/></filter><rect width="100" height="100" fill="%238d5524"/><g filter="url(%23f)"><circle cx="20" cy="80" r="30" fill="%23c86b53"/><circle cx="80" cy="70" r="40" fill="%23a26e49"/><circle cx="50" cy="30" r="25" fill="%23f7b267"/></g></svg>');
            background-size: cover;
            filter: blur(5px);
            transform: scale(1.1);
            z-index: 1;
        }
        .fall-leaves-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
        }
        #fall-leaves-back { z-index: 2; transform: scale(0.7); filter: blur(1px) brightness(0.9); }
        #fall-leaves-mid { z-index: 4; }
        #fall-leaves-front { z-index: 6; transform: scale(1.3); filter: blur(0) brightness(1.1); }

        .leaf {
            position: absolute;
            background-size: contain;
            background-repeat: no-repeat;
            animation: fall-leaf-gust linear infinite;
        }
        @keyframes fall-leaf-gust {
            0% { transform: translate(var(--x-start), -10vh) rotate(var(--r-start)); opacity: 1; }
            20% { transform: translate(calc(var(--x-start) + var(--x-gust1)), 20vh) rotate(calc(var(--r-start) + 200deg)); }
            40% { transform: translate(calc(var(--x-start) + var(--x-gust2)), 40vh) rotate(calc(var(--r-start) + 400deg)); }
            60% { transform: translate(calc(var(--x-start) + var(--x-gust3)), 60vh) rotate(calc(var(--r-start) + 600deg)); }
            80% { transform: translate(calc(var(--x-start) + var(--x-gust4)), 80vh) rotate(calc(var(--r-start) + 800deg)); }
            100% { transform: translate(var(--x-end), 110vh) rotate(var(--r-end)); opacity: 0; }
        }
        .ground-leaves {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 5%;
            z-index: 5;
            pointer-events: none;
        }
        .ground-leaf {
            position: absolute;
            background-size: contain;
            background-repeat: no-repeat;
            animation: rustle-leaf ease-in-out infinite alternate;
        }
        @keyframes rustle-leaf {
            from { transform: rotate(var(--r1)) translateX(-2px); }
            to { transform: rotate(var(--r2)) translateX(2px); }
        }

        .fall-wind-particle {
            position: absolute;
            width: 80px;
            height: 2px;
            background: linear-gradient(to right, rgba(255, 255, 220, 0.15), transparent);
            border-radius: 2px;
            animation: wind-gust-fall linear infinite;
            z-index: 3; /* Between back and mid leaves */
        }

        @keyframes wind-gust-fall {
            0% {
                transform: translateX(-100px) scaleX(0.5);
                opacity: 0;
            }
            10%, 80% {
                opacity: 0.7;
            }
            100% {
                transform: translateX(110vw) scaleX(1.5);
                opacity: 0;
            }
        }

        /* --- Summer Theme --- */
        #summer-theme {
            background-color: #ffefd5;
            overflow: hidden;
        }
        .summer-sky {
            position: absolute; width: 100%; height: 100%;
            background: linear-gradient(to top, #fceabb, #f8b500, #ffdd77);
            z-index: 1;
        }
        .god-rays-summer {
            position: absolute; top: -20%; left: -20%;
            width: 140%; height: 140%;
            transform-origin: center;
            animation: summer-god-ray-anim 80s ease-in-out infinite alternate;
            z-index: 2;
        }
        .summer-god-ray {
            position: absolute;
            top: 0;
            background: linear-gradient(to bottom, rgba(255, 250, 220, 0.25) 0%, rgba(255, 250, 220, 0) 60%);
            transform-origin: top center;
            animation: ray-breathe 8s ease-in-out infinite alternate;
        }
        @keyframes summer-god-ray-anim {
            from { transform: rotate(-15deg); }
            to { transform: rotate(15deg); }
        }
        @keyframes ray-breathe {
            from { opacity: 0.5; }
            to { opacity: 1; }
        }
        .dandelion-seed {
            position: absolute;
            width: 20px;
            height: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.8)"/><line x1="10" y1="10" x2="5" y2="5" stroke="rgba(255,255,255,0.8)" stroke-width="0.5"/><line x1="10" y1="10" x2="15" y2="5" stroke="rgba(255,255,255,0.8)" stroke-width="0.5"/><line x1="10" y1="10" x2="5" y2="15" stroke="rgba(255,255,255,0.8)" stroke-width="0.5"/><line x1="10" y1="10" x2="15" y2="15" stroke="rgba(255,255,255,0.8)" stroke-width="0.5"/></svg>');
            background-size: contain;
            animation: float-seed-realistic 20s ease-in-out infinite;
            z-index: 4;
        }
        @keyframes float-seed-realistic {
            0% { transform: translate(var(--x-start), var(--y-start)) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            50% { transform: translate(var(--x-mid), var(--y-mid)) rotate(180deg); }
            90% { opacity: 1; }
            100% { transform: translate(var(--x-end), var(--y-end)) rotate(360deg); opacity: 0; }
        }
        .heat-haze {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="haze"><feTurbulence type="turbulence" baseFrequency="0.01 0.03" numOctaves="1" result="turbulence"/><feDisplacementMap in2="turbulence" in="SourceGraphic" scale="5" xChannelSelector="R" yChannelSelector="G"/></filter><rect width="200" height="200" fill="transparent" filter="url(%23haze)"/></svg>');
            background-size: 200px 200px;
            animation: heat-haze-shimmer 10s linear infinite alternate;
            z-index: 5;
        }
        @keyframes heat-haze-shimmer {
            0% { background-position: 0% 0%; opacity: 0.1; }
            50% { opacity: 0.4; }
            100% { background-position: 100% 100%; opacity: 0.1; }
        }
        .summer-grass {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 15%;
            z-index: 3;
        }
        .summer-grass-blade {
            position: absolute;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to top, #c4a464, #e6d8a8);
            border-radius: 2px 2px 0 0;
            transform-origin: bottom center;
            animation: summer-sway 7s ease-in-out infinite alternate;
        }
        @keyframes summer-sway {
            from { transform: rotate(-3deg); }
            to { transform: rotate(3deg); }
        }

        /* --- Spring Theme --- */
        #spring-theme {
            background: linear-gradient(to top, #b0c4de, #dcedc1, #e0f0e8);
            overflow: hidden;
        }
        #spring-clouds {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 40%;
            z-index: 0;
        }
        .spring-cloud {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            filter: blur(15px);
            animation: drift-cloud linear infinite;
        }
        @keyframes drift-cloud {
            from { transform: translateX(-20vw); }
            to { transform: translateX(120vw); }
        }

        #rainbow-container {
            position: absolute;
            top: 10%; left: 50%;
            width: 80vh; height: 40vh;
            transform: translateX(-50%);
            z-index: 1;
            overflow: hidden;
            animation: rainbow-fade 90s ease-in-out infinite;
            opacity: 0;
        }
        #rainbow-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 200%;
            border-radius: 50%;
            background: conic-gradient(from 0.25turn at 50% 100%, red, orange, yellow, green, blue, indigo, violet, transparent);
            -webkit-mask-image: radial-gradient(ellipse 50% 100% at 50% 100%, black 60%, transparent 60.5%);
        }
        @keyframes rainbow-fade {
            0%, 100% { opacity: 0; }
            5% { opacity: 0.7; }
            15% { opacity: 0.7; }
            20% { opacity: 0; }
        }

        .rain-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #rain-back { z-index: 2; filter: blur(1px); opacity: 0.7; }
        #rain-mid { z-index: 4; }
        #rain-front { z-index: 6; filter: brightness(1.2); }

        .spring-raindrop {
            position: absolute; bottom: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(200,220,240,0.8));
            animation: spring-rain-fall linear infinite;
        }
        @keyframes spring-rain-fall {
            to { transform: translateY(calc(100vh + 100px)) translateX(var(--x-drift)); }
        }
        .spring-ground {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 10%;
            background: linear-gradient(to top, #6a994e, #89c2d9);
            z-index: 1;
        }
        #sprouts-container {
            position: absolute; bottom: 8%; left: 0; width: 100%; height: 20%; z-index: 3;
        }
        .sprout {
            position: absolute; bottom: 0; width: 20px; height: 40px;
            transform-origin: bottom center;
            animation: sprout-life-cycle 25s ease-in-out infinite;
        }
        .sprout > div { /* Leaf container */
            position: absolute; bottom: 0; width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 40"><path d="M 10 40 C 0 30, 0 10, 10 0 C 20 10, 20 30, 10 40 Z" fill="rgba(119, 221, 119, 0.9)"/></svg>');
            background-size: contain; background-repeat: no-repeat;
            transform-origin: bottom center;
            animation: sprout-sway 5s ease-in-out infinite alternate;
            animation-play-state: paused;
        }
        .sprout .left { transform: rotate(-15deg); }
        .sprout .right { transform: rotate(15deg); }

        @keyframes sprout-life-cycle {
            0% { transform: scaleY(0); } /* Grow */
            10% { transform: scaleY(1); }
            15% { /* Start swaying */
                animation-play-state: running;
            }
            85% { /* Stop swaying, start wilting */
                transform: scaleY(1);
                filter: saturate(1);
                animation-play-state: paused;
            }
            95% {
                transform: scaleY(0.8);
                filter: saturate(0.5);
            }
            100% { transform: scaleY(0); }
        }
        @keyframes sprout-sway-left {
            from { transform: rotate(-20deg); }
            to { transform: rotate(-10deg); }
        }
        @keyframes sprout-sway-right {
            from { transform: rotate(10deg); }
            to { transform: rotate(20deg); }
        }
        .sprout .left { animation-name: sprout-sway-left; }
        .sprout .right { animation-name: sprout-sway-right; }
        .sprout::after { /* Dewdrop */
            content: '';
            position: absolute; top: 30%; left: 45%;
            width: 5px; height: 5px;
            background-color: rgba(220, 230, 255, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(220, 230, 255, 1);
            animation: glisten 4s ease-in-out infinite alternate;
            opacity: 0;
            animation-delay: inherit; /* Inherit delay from parent .sprout */
        }
        @keyframes glisten {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* --- Aurora Theme --- */
        #aurora-theme {
            background-color: #00020c;
            overflow: hidden;
        }
        #aurora-stars {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        .aurora-star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 10s ease-in-out infinite;
        }
        .aurora-curtain {
            position: absolute;
            top: -50%; left: -25%;
            width: 150%; height: 200%;
            transform-origin: center;
            mix-blend-mode: screen;
            animation: aurora-curtain-flow 30s ease-in-out infinite alternate;
        }
        #aurora-layer-1 {
            background: radial-gradient(ellipse at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0) 40%, #00ff99 100%);
            animation-duration: 25s;
            z-index: 2;
        }
        #aurora-layer-2 {
            background: radial-gradient(ellipse at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0) 40%, #66ccff 100%);
            animation-duration: 20s;
            animation-direction: alternate-reverse;
            z-index: 3;
        }
        #aurora-layer-3 {
            background: radial-gradient(ellipse at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0) 40%, #ff66cc 100%);
            animation-duration: 35s;
            z-index: 1;
        }
        @keyframes aurora-curtain-flow {
            0% {
                transform: rotate(0deg) scale(1) skewX(0deg) translateY(0%);
                filter: blur(5px) brightness(1);
            }
            50% {
                transform: rotate(10deg) scale(1.2) skewX(15deg) translateY(10%);
                filter: blur(10px) brightness(1.5);
            }
            100% {
                transform: rotate(-5deg) scale(0.9) skewX(-10deg) translateY(-5%);
                filter: blur(8px) brightness(1.2);
            }
        }

        /* --- Galaxy Theme --- */
        #galaxy-theme {
            background-color: #000005;
            overflow: hidden;
            perspective: 800px;
        }
        #galaxy-stars-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        .galaxy-star-bg {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 15s ease-in-out infinite;
        }
        .nebula-container {
            position: absolute;
            top: 50%; left: 50%;
            width: 100vmin; height: 100vmin;
            transform-style: preserve-3d;
            animation: slow-rotate-3d 240s linear infinite;
        }
        @keyframes slow-rotate-3d {
            from { transform: translate(-50%, -50%) rotateY(0deg) rotateX(10deg); }
            to { transform: translate(-50%, -50%) rotateY(360deg) rotateX(10deg); }
        }
        .nebula {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border-radius: 50%;
            mix-blend-mode: screen;
            filter: blur(40px);
        }
        #nebula-layer-1 {
            background: radial-gradient(circle, #ff33cc 0%, #ff33cc 10%, rgba(0,0,0,0) 60%);
            transform: translateZ(-100px) rotateY(60deg);
            animation: nebula-pulse 20s ease-in-out infinite alternate;
        }
        #nebula-layer-2 {
            background: radial-gradient(circle, #33ccff 0%, #33ccff 10%, rgba(0,0,0,0) 50%);
            transform: translateZ(50px) rotateY(-40deg) scale(0.8);
            animation: nebula-pulse 25s ease-in-out infinite alternate-reverse;
        }
        #nebula-layer-3 {
            background: radial-gradient(circle, #9933ff 0%, #9933ff 10%, rgba(0,0,0,0) 70%);
            transform: translateZ(150px) rotateY(20deg) scale(1.2);
            animation: nebula-pulse 30s ease-in-out infinite alternate;
        }
        @keyframes nebula-pulse {
            from { opacity: 0.7; transform: scale(1); }
            to { opacity: 1; transform: scale(1.1); }
        }
        #shooting-stars {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            transform: rotate(20deg);
            z-index: 10;
        }
        .shooting-star {
            position: absolute;
            height: 1px;
            background: linear-gradient(to right, white, transparent);
            animation: shoot 10s linear infinite;
        }
        @keyframes shoot {
            from { left: -50%; transform: scaleX(0.5); opacity: 1; }
            70% { opacity: 1; }
            to { left: 150%; transform: scaleX(1); opacity: 0; }
        }

        /* --- Rainy Window Theme --- */
        #rainy-window-theme {
            background-color: #2c3e50;
            overflow: hidden;
        }
        .rainy-bg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600"><filter id="g"><feGaussianBlur stdDeviation="5"/></filter><g filter="url(%23g)"><rect x="0" y="400" width="800" height="200" fill="%2334495e"/><path d="M 100 400 L 150 200 L 200 400 Z" fill="%232c3e50"/><path d="M 300 400 L 320 300 L 340 400 Z" fill="%232c3e50"/><path d="M 500 400 L 550 100 L 600 400 Z" fill="%232c3e50"/></g></svg>');
            background-size: cover;
            filter: blur(4px);
            transform: scale(1.05);
            z-index: 1;
        }
        #rain-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 2;
        }
        .lightning-flash {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: white;
            opacity: 0;
            z-index: 3;
            pointer-events: none;
            animation: flash-lightning 10s linear infinite;
        }
        @keyframes flash-lightning {
            0% { opacity: 0; }
            49% { opacity: 0; }
            50% { opacity: 0.7; }
            50.5% { opacity: 0.2; }
            51% { opacity: 1; }
            52% { opacity: 0; }
            100% { opacity: 0; }
        }

        /* --- Koi Pond Theme --- */
        #koi-pond-theme {
            background-color: #3b5249;
            overflow: hidden;
        }
        .water-depth-overlay {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(to top, rgba(10, 20, 15, 0.4) 0%, transparent 50%);
            z-index: 1;
        }
        .water-surface {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(175deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 5%);
            animation: shimmer-water 15s ease-in-out infinite alternate;
            z-index: 2;
        }
        @keyframes shimmer-water {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }
        #lily-pads {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3;
        }
        .lily-pad {
            position: absolute;
            width: 100px; height: 100px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M 50 50 C 20 100, 80 100, 50 50 M 50 50 C 0 20, 0 80, 50 50 M 50 50 C 80 0, 20 0, 50 50" fill="%232d6a4f" stroke="%231b4332" stroke-width="2"/></svg>');
            animation: float-bob-complex 20s ease-in-out infinite alternate;
        }
        @keyframes float-bob-complex {
            0% { transform: translate(var(--x-pos), var(--y-pos)) rotate(-2deg) scale(1); }
            25% { transform: translate(var(--x-pos), calc(var(--y-pos) - 2px)) rotate(0deg) scale(1.01); }
            50% { transform: translate(var(--x-pos), var(--y-pos)) rotate(2deg) scale(1); }
            75% { transform: translate(var(--x-pos), calc(var(--y-pos) + 2px)) rotate(0deg) scale(0.99); }
            100% { transform: translate(var(--x-pos), var(--y-pos)) rotate(-2deg) scale(1); }
        }
        #koi-fish {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 4;
        }
        .koi {
            position: absolute;
            width: 100px; height: 40px;
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            animation: swim-koi 25s ease-in-out infinite;
        }
        @keyframes swim-koi {
            0%   { transform: translate(var(--x1), var(--y1)) rotate(var(--r1)); }
            20%  { transform: translate(var(--x2), var(--y2)) rotate(var(--r2)); }
            40%  { transform: translate(var(--x3), var(--y3)) rotate(var(--r3)); }
            60%  { transform: translate(var(--x4), var(--y4)) rotate(var(--r4)); }
            80%  { transform: translate(var(--x5), var(--y5)) rotate(var(--r5)); }
            100% { transform: translate(var(--x1), var(--y1)) rotate(var(--r1)); }
        }
        #koi-ripples {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5;
        }
        .koi-ripple {
            position: absolute;
            border: 1px solid rgba(200, 220, 240, 0.3);
            border-radius: 50%;
            animation: expand-ripple 3s ease-out;
            transform-origin: center;
        }
        @keyframes expand-ripple {
            from { transform: scale(0); opacity: 1; }
            to { transform: scale(1); opacity: 0; }
        }

        /* --- Meadow Theme --- */
        #meadow-theme {
            background: linear-gradient(to top, #89c2d9, #a7c957, #6a994e);
            overflow: hidden;
        }
        .meadow-sky {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, #dcedc1, #a8e6cf);
            z-index: 1;
        }
        .meadow-grass {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 20%;
            z-index: 5;
        }
        .grass-blade {
            position: absolute; bottom: 0;
            width: 3px;
            background: linear-gradient(to top, #4d7c3d, #6a994e);
            border-radius: 3px 3px 0 0;
            transform-origin: bottom center;
            animation: sway 5s ease-in-out infinite alternate;
        }
        @keyframes sway {
            from { transform: rotate(-5deg); }
            to { transform: rotate(5deg); }
        }
        #meadow-pollen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 4;
        }
        .pollen-particle {
            position: absolute;
            width: 4px; height: 4px;
            background-color: #f2e8cf;
            border-radius: 50%;
            animation: pollen-gust 10s ease-in-out infinite;
        }
        @keyframes pollen-gust {
            0% { transform: translate(var(--x-start), var(--y-start)) scale(1); opacity: 0; }
            25% { transform: translate(calc(var(--x-start) + var(--x-gust1)), calc(var(--y-start) - 30vh)) scale(0.8); opacity: 1; }
            50% { transform: translate(calc(var(--x-start) + var(--x-gust2)), calc(var(--y-start) - 60vh)) scale(1); opacity: 1; }
            75% { transform: translate(calc(var(--x-start) + var(--x-gust3)), calc(var(--y-start) - 90vh)) scale(0.7); opacity: 1; }
            100% { transform: translate(var(--x-end), -20vh) scale(0.5); opacity: 0; }
        }
        #meadow-butterflies {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3;
        }
        .butterfly {
            position: absolute;
            width: 30px; height: 30px;
            animation: butterfly-path-realistic 20s linear infinite;
        }
        .butterfly-wing {
            position: absolute;
            width: 50%; height: 100%;
            background-size: contain;
            background-repeat: no-repeat;
            transform-origin: right center;
        }
        .butterfly-wing.left {
            left: 0;
            animation: flap-left 0.5s ease-in-out infinite alternate;
        }
        .butterfly-wing.right {
            right: 0;
            transform: scaleX(-1); /* Mirror the right wing */
            animation: flap-right 0.5s ease-in-out infinite alternate;
        }
        @keyframes butterfly-path-realistic {
            0% { transform: translate(var(--x1), var(--y1)) rotate(0deg); }
            12% { transform: translate(var(--x2), var(--y2)) rotate(20deg) scale(1.1); }
            25% { transform: translate(var(--x3), var(--y3)) rotate(-10deg); }
            37% { transform: translate(var(--x4), var(--y4)) rotate(15deg) scale(1); }
            50% { transform: translate(var(--x5), var(--y5)) rotate(5deg); }
            62% { transform: translate(var(--x6), var(--y6)) rotate(-20deg) scale(1.1); }
            75% { transform: translate(var(--x7), var(--y7)) rotate(10deg); }
            87% { transform: translate(var(--x8), var(--y8)) rotate(-5deg) scale(1); }
            100% { transform: translate(var(--x1), var(--y1)) rotate(0deg); }
        }
        @keyframes flap-left {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(-70deg); }
        }
        @keyframes flap-right {
            from { transform: scaleX(-1) rotateY(0deg); }
            to { transform: scaleX(-1) rotateY(-70deg); }
        }

        #meadow-flowers {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 25%;
            z-index: 6; /* In front of grass */
        }
        .meadow-flower {
            position: absolute;
            bottom: 0;
            width: 15px; height: 25px;
            background-size: contain;
            background-repeat: no-repeat;
            animation: flower-bob 10s ease-in-out infinite alternate;
        }
        @keyframes flower-bob {
            from { transform: rotate(-3deg); }
            to { transform: rotate(3deg); }
        }

        /* --- Cosmic Chimes Theme --- */
        #cosmic-chimes-theme {
            background-color: #0c0a1a;
            overflow: hidden;
        }
        .chime-nebula {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(ellipse at 50% 50%, rgba(100, 150, 200, 0.2) 0%, rgba(0,0,0,0) 60%);
            animation: slow-rotate-3d 180s linear infinite;
        }
        #space-dust { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; }
        .dust-particle {
            position: absolute;
            background-color: #aaddff;
            border-radius: 50%;
            animation: dust-float 30s ease-in-out infinite alternate;
        }
        @keyframes dust-float {
            from { transform: translate(var(--x-start), var(--y-start)); opacity: 0; }
            50% { opacity: 0.5; }
            to { transform: translate(var(--x-end), var(--y-end)); opacity: 0; }
        }
        .chime {
            position: absolute;
            width: 3px;
            height: 120px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(173, 216, 230, 0.9), rgba(255, 255, 255, 0));
            animation: shimmer-chime 12s ease-in-out infinite;
            z-index: 3;
        }
        @keyframes shimmer-chime {
            0%, 100% { opacity: 0; transform: scaleY(0.8) rotate(var(--r-start)); }
            50% { opacity: 1; transform: scaleY(1) rotate(var(--r-end)); box-shadow: 0 0 20px #ade6e6, 0 0 35px #ade6e6; }
        }

        /* --- Singing Bowl Theme --- */
        #singing-bowl-theme {
            background: radial-gradient(circle at 50% 50%, #1a1225, #0c0a1a 70%);
            overflow: hidden;
        }
        #singing-bowl-glow {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80vmin; height: 80vmin;
            background:
                radial-gradient(circle, rgba(180, 160, 220, 0.15) 0%, rgba(0,0,0,0) 60%),
                radial-gradient(circle, rgba(160, 220, 200, 0.1) 20%, rgba(0,0,0,0) 70%);
            animation: slow-pulse-color 12s ease-in-out infinite alternate;
        }
        @keyframes slow-pulse-color {
            from { transform: translate(-50%, -50%) scale(0.95); filter: brightness(1) saturate(1); }
            to { transform: translate(-50%, -50%) scale(1.05); filter: brightness(1.2) saturate(1.5) hue-rotate(45deg); }
        }
        .singing-bowl-silhouette {
            position: absolute; bottom: 0; left: 50%;
            transform: translateX(-50%);
            width: 60vmin; height: 30vmin;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><path d="M 0 100 L 200 100 L 180 20 C 150 0, 50 0, 20 20 Z" fill="rgba(0,0,0,0.4)"/></svg>');
            background-size: 100% 100%;
            z-index: 2;
            animation: bowl-vibrate 10s ease-in-out infinite alternate;
        }
        @keyframes bowl-vibrate {
            0%, 100% { transform: translateX(-50%) translateY(0) rotate(0); }
            50% { transform: translateX(-50.1%) translateY(-1px) rotate(-0.1deg); }
        }
        #bowl-ripples {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 3;
            perspective: 500px;
        }
        .bowl-ripple {
            position: absolute;
            left: 50%;
            bottom: 30vmin; /* Start from just above the bowl's base */
            border: 2px solid rgba(200, 180, 220, 0.7);
            border-radius: 50%;
            animation: bowl-ripple-effect ease-out infinite;
            transform: translateX(-50%);
        }
        @keyframes bowl-ripple-effect {
            from {
                width: 10vmin;
                height: 5vmin; /* Elliptical start */
                opacity: 1;
                transform: translateX(-50%) rotateX(60deg) scale(0.1);
            }
            to {
                width: 150vmin;
                height: 75vmin; /* Elliptical end */
                opacity: 0;
                transform: translateX(-50%) rotateX(60deg) scale(1);
            }
        }
        #bowl-motes { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 4; }
        .bowl-mote {
            position: absolute;
            background-color: rgba(220, 200, 240, 0.8);
            border-radius: 50%;
            animation: mote-weave 15s ease-in-out infinite;
            box-shadow: 0 0 8px rgba(220, 200, 240, 0.5);
        }
        @keyframes mote-weave {
            0% {
                transform: translateY(80vh) translateX(0) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(55vh) translateX(var(--x-drift)) scale(0.8);
            }
            100% {
                transform: translateY(30vh) translateX(0) scale(0.5);
                opacity: 0;
            }
        }


        /* --- Starlight Theme --- */
        #starlight-theme {
            background-color: #0c0a1a;
            overflow: hidden;
        }
        #starlight-nebula {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at 50% 50%, rgba(100, 120, 180, 0.15) 0%, rgba(0,0,0,0) 70%);
            animation: slow-rotate-3d 300s linear infinite;
        }
        .starlight-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #starlights-back { transform: translateZ(-200px) scale(1.5); filter: blur(1px); opacity: 0.7; }
        #starlights-mid { transform: translateZ(-100px) scale(1.2); }
        #starlights-front { transform: translateZ(0px) scale(1); }
        .starlight {
            position: absolute;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #adc8ff;
            animation: starlight-pulse-deep 8s ease-in-out infinite alternate;
        }
        @keyframes starlight-pulse-deep {
            from {
                opacity: 0.5;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        #starlight-shooting-stars {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            transform: rotate(15deg);
            z-index: 5;
        }
        .shooting-star-starlight {
            position: absolute;
            height: 2px;
            background: linear-gradient(to right, white, transparent);
            animation: shoot-starlight linear infinite;
        }
        @keyframes shoot-starlight {
            from { left: -50%; transform: scaleX(0.3); opacity: 1; }
            70% { opacity: 1; }
            to { left: 150%; transform: scaleX(1.5); opacity: 0; }
        }

        /* --- Geode Theme --- */
        #geode-theme {
            background: radial-gradient(circle, #2c2a3e, #1a182a 80%);
            overflow: hidden;
        }
        .crystal {
            position: absolute;
            background-size: contain;
            background-repeat: no-repeat;
            animation: grow-crystal 40s ease-in-out infinite alternate;
            z-index: 1;
        }
        @keyframes grow-crystal {
            from { transform: scale(0.95) rotate(var(--r-start)); opacity: 0.8; }
            to { transform: scale(1.05) rotate(var(--r-end)); opacity: 1; }
        }
        .crystal-glow {
            position: absolute;
            width: 100%; height: 100%;
            background: inherit;
            opacity: 0.7;
            animation: pulse-glow 8s ease-in-out infinite alternate;
        }
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.6; transform: scale(0.98); filter: blur(15px) brightness(1); }
            50% { opacity: 0.9; transform: scale(1.02); filter: blur(20px) brightness(1.5); }
        }

        #geode-dust-back, #geode-dust-mid, #geode-dust-front {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
        }
        #geode-dust-back { z-index: 0; transform: scale(0.8); filter: blur(1px); }
        #geode-dust-mid { z-index: 2; }
        #geode-dust-front { z-index: 4; transform: scale(1.2); }

        .geode-dust-particle {
            position: absolute;
            background-color: #e0e0ff;
            border-radius: 50%;
            animation: geode-dust-drift ease-in-out infinite;
        }
        @keyframes geode-dust-drift {
            0% { transform: translate(var(--x-start), var(--y-start)); opacity: 0; }
            50% { opacity: var(--opacity); }
            100% { transform: translate(var(--x-end), var(--y-end)); opacity: 0; }
        }

        /* --- Bioluminescence Theme --- */
        #bioluminescence-theme {
            background-color: #080a0c;
            overflow: hidden;
        }
        .bio-mushroom {
            position: absolute;
            bottom: 0;
            width: 80px;
            height: 100px;
        }
        .bio-mushroom-cap {
            position: absolute;
            top: 0; left: 50%;
            transform: translateX(-50%);
            width: 100%; height: 60%;
            background: radial-gradient(circle at 50% 100%, #81ecec, #55efc4);
            border-radius: 50% 50% 0 0;
            animation: pulse-mushroom 10s ease-in-out infinite;
            box-shadow: 0 0 15px #81ecec, 0 0 25px #55efc4;
        }
        .bio-mushroom-stem {
            position: absolute;
            bottom: 0; left: 50%;
            transform: translateX(-50%);
            width: 20%; height: 50%;
            background: linear-gradient(to top, #74b9ff, #a29bfe);
        }
        @keyframes pulse-mushroom {
            0%, 100% { filter: brightness(0.8) saturate(0.8); }
            50% { filter: brightness(1.2) saturate(1.2); }
        }
        .bio-spore {
            position: absolute;
            width: 3px; height: 3px;
            background-color: #a29bfe;
            border-radius: 50%;
            box-shadow: 0 0 5px #a29bfe, 0 0 10px #a29bfe;
            animation: spore-float 20s ease-in-out infinite;
        }
        @keyframes spore-float {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(-100vh) translateX(var(--x-drift)); opacity: 0; }
        }

        /* --- Swedish Forest Theme --- */
        #swedish-forest-theme {
            background: linear-gradient(to top, #0a141a, #1a2a3a);
            overflow: hidden;
        }
        .sf-parallax {
            position: absolute;
            bottom: 0; left: 0;
            width: 200%; height: 100%;
            will-change: transform;
        }
        #sf-layer-1 { animation: slide 240s linear infinite; z-index: 1; }
        #sf-layer-2 { animation: slide 180s linear infinite; z-index: 3; }
        #sf-layer-3 { animation: slide 120s linear infinite; z-index: 5; }

        .god-ray-container {
            position: absolute; top: -10%; left: 0;
            width: 100%; height: 110%;
            animation: god-ray-anim 60s ease-in-out infinite alternate;
            transform-origin: center top;
            z-index: 2;
        }
        .god-ray {
            position: absolute; top: 0;
            background: linear-gradient(to bottom, rgba(255, 255, 220, 0.15) 0%, rgba(255, 255, 220, 0) 70%);
            transform-origin: top center;
        }
        @keyframes god-ray-anim {
            from { transform: rotate(-10deg); }
            to { transform: rotate(10deg); }
        }

        .mist {
            position: absolute;
            bottom: 0; left: 0;
            width: 200%; height: 25%;
            background: linear-gradient(to top, rgba(150, 160, 170, 0.2) 0%, rgba(150, 160, 170, 0) 100%);
            animation: mist-anim 90s linear infinite;
            z-index: 4;
        }
        @keyframes mist-anim {
            from { transform: translateX(0%); }
            to { transform: translateX(-50%); }
        }

        .forest-spirit {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: rgba(180, 220, 255, 0.5);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(180, 220, 255, 0.7), 0 0 20px rgba(180, 220, 255, 0.5);
            animation: spirit-drift 25s ease-in-out infinite alternate;
            z-index: 6;
        }

        @keyframes spirit-drift {
            from {
                transform: translate(var(--x-start), var(--y-start)) scale(1);
                opacity: 0.7;
            }
            to {
                transform: translate(var(--x-end), var(--y-end)) scale(1.2);
                opacity: 0.9;
            }
        }

        /* --- Desert Oasis Theme --- */
        #desert-oasis-theme {
            background-color: #1a182a; /* Fallback for the gradient */
            overflow: hidden;
        }
        .desert-sky {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(to top, #4c3a51 0%, #774a58 30%, #a85c61 60%, #ff8c61 100%);
            animation: desert-sky-cycle 240s linear infinite;
            z-index: 1;
        }
        @keyframes desert-sky-cycle {
            0% { background: linear-gradient(to top, #2c213d 0%, #4a3a5f 40%, #7b526f 80%, #a86c7f 100%); } /* Twilight */
            50% { background: linear-gradient(to top, #0d0a1a 0%, #1a1225 50%, #3b2a4a 100%); } /* Night */
            100% { background: linear-gradient(to top, #2c213d 0%, #4a3a5f 40%, #7b526f 80%, #a86c7f 100%); } /* Twilight */
        }
        #desert-stars {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2;
        }
        .desert-star {
            position: absolute; background: white; border-radius: 50%;
            animation: twinkle 12s infinite ease-in-out;
            opacity: 0;
            animation-name: twinkle, fade-in-stars;
        }
        @keyframes fade-in-stars {
             0%, 100% { opacity: 0; }
             50% { opacity: 0.8; }
        }
        .desert-dunes {
            position: absolute; bottom: 0; left: 0;
            width: 200%; height: 40%;
            background-repeat: repeat-x;
            background-position: 0 bottom;
            animation: slide linear infinite;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 120"><path d="M 0 120 Q 200 0, 400 120 T 800 120" fill="rgba(60,45,65,1)"/></svg>');
        }
        #desert-dunes-back { animation-duration: 220s; z-index: 3; filter: brightness(0.6); opacity: 0.8; }
        #desert-dunes-mid { animation-duration: 160s; z-index: 5; filter: brightness(0.8); opacity: 0.9; }
        #desert-dunes-front { animation-duration: 100s; z-index: 7; filter: brightness(1); }

        #desert-rocks {
            position: absolute; bottom: 0; left: 0;
            width: 200%; height: 50%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 200"><path d="M 50 200 L 100 100 L 150 150 L 200 80 L 250 200 Z" fill="rgba(40,30,45,0.7)"/><path d="M 450 200 L 520 50 L 580 200 Z" fill="rgba(40,30,45,0.7)"/><path d="M 650 200 L 700 120 L 750 200 Z" fill="rgba(40,30,45,0.7)"/></svg>');
            background-repeat: repeat-x;
            animation: slide 180s linear infinite;
            z-index: 4;
            filter: drop-shadow(-10px 5px 5px rgba(0,0,0,0.3));
        }

        .desert-mirage {
            position: absolute; bottom: 15%; left: 0;
            width: 100%; height: 25%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="mirage"><feTurbulence type="turbulence" baseFrequency="0.005 0.015" numOctaves="2" result="turbulence"/><feDisplacementMap in2="turbulence" in="SourceGraphic" scale="8" xChannelSelector="R" yChannelSelector="G"/></filter><rect width="200" height="200" fill="transparent" filter="url(%23mirage)"/></svg>');
            background-size: 200px 100px;
            animation: heat-haze-shimmer 10s linear infinite alternate;
            opacity: 0.2;
            z-index: 6;
        }

        #desert-sand-particles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 8; }
        .sand-particle {
            position: absolute;
            width: 2px; height: 2px;
            background-color: #f0e68c;
            border-radius: 50%;
            animation: sand-drift ease-in-out infinite;
        }
        @keyframes sand-drift {
            0% { transform: translate(var(--x-start), var(--y-start)) scale(1); opacity: 0; }
            50% { opacity: 0.7; }
            100% { transform: translate(var(--x-end), var(--y-end)) scale(0.5); opacity: 0; }
        }

        #desert-fauna { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; z-index: 9; }
        .desert-lizard {
            position: absolute;
            bottom: 0;
            width: 40px; height: 10px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 10"><path d="M 0 5 Q 20 -5, 40 5" fill="none" stroke="rgba(20,10,5,0.8)" stroke-width="2"/></svg>');
            animation: scurry-lizard 30s linear infinite;
        }
        @keyframes scurry-lizard {
            0% { transform: translateX(-10vw); opacity: 0; }
            5% { transform: translateX(10vw); opacity: 1; }
            45% { transform: translateX(90vw); opacity: 1; }
            50% { transform: translateX(110vw); opacity: 0; }
            100% { transform: translateX(110vw); opacity: 0; }
        }
        .desert-moth {
            position: absolute;
            width: 15px; height: 15px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M 10 10 C 0 0, 20 0, 10 10 M 10 10 C 0 20, 20 20, 10 10" fill="rgba(240,230,140,0.7)"/></svg>');
            animation: flutter-moth 20s ease-in-out infinite;
        }
        @keyframes flutter-moth {
            0% { transform: translate(var(--x-start), var(--y-start)) rotate(0deg); }
            50% { transform: translate(var(--x-end), var(--y-end)) rotate(360deg); }
            100% { transform: translate(var(--x-start), var(--y-start)) rotate(0deg); }
        }


        #desert-flora { position: absolute; bottom: 0; left: 0; width: 100%; height: 40%; z-index: 4; }
        .cactus {
            position: absolute;
            width: 10px;
            background-color: #556b2f;
            border-radius: 4px;
        }
        .desert-flower {
            position: absolute;
            width: 15px; height: 15px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><circle cx="10" cy="10" r="4" fill="%23ffb6c1"/><circle cx="10" cy="5" r="2" fill="%23ff69b4"/><circle cx="15" cy="10" r="2" fill="%23ff69b4"/><circle cx="10" cy="15" r="2" fill="%23ff69b4"/><circle cx="5" cy="10" r="2" fill="%23ff69b4"/></svg>');
            animation: bloom-flower 15s ease-in-out infinite alternate;
        }
        @keyframes bloom-flower {
            from { transform: scale(0.8); opacity: 0.7; }
            to { transform: scale(1); opacity: 1; }
        }
        .cactus::before, .cactus::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 50%;
            background-color: inherit;
            border-radius: 4px;
        }
        .cactus::before { top: 20%; left: -80%; height: 40%; transform: rotate(30deg); }
        .cactus::after { top: 10%; left: 80%; transform: rotate(-30deg); }

        .palm-tree {
            position: absolute;
            width: 8px;
            background: #8b4513;
        }
        .palm-tree::after {
            content: '';
            position: absolute;
            top: -30px; left: -35px;
            width: 80px; height: 80px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80"><path d="M 40 40 C 0 0, 80 0, 40 40" fill="%23228B22" transform="rotate(0 40 40)"/><path d="M 40 40 C 0 0, 80 0, 40 40" fill="%23228B22" transform="rotate(60 40 40)"/><path d="M 40 40 C 0 0, 80 0, 40 40" fill="%23228B22" transform="rotate(120 40 40)"/><path d="M 40 40 C 0 0, 80 0, 40 40" fill="%23228B22" transform="rotate(180 40 40)"/><path d="M 40 40 C 0 0, 80 0, 40 40" fill="%23228B22" transform="rotate(240 40 40)"/><path d="M 40 40 C 0 0, 80 0, 40 40" fill="%23228B22" transform="rotate(300 40 40)"/></svg>');
            transform-origin: center;
            animation: sway-palm 10s ease-in-out infinite alternate;
        }
        @keyframes sway-palm {
            from { transform: rotate(-5deg); }
            to { transform: rotate(5deg); }
        }

        /* --- Bamboo Grove Theme --- */
        #bamboo-grove-theme {
            background-color: #d8e2dc;
            overflow: hidden;
        }
        .bamboo-sky {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, #fdfcdc, #c8d5b9, #8fc0a9);
            z-index: 1;
        }
        .bamboo-grove {
            position: absolute; bottom: 0; left: 0;
            width: 100%; height: 100%;
            transform-origin: bottom center;
            animation: sway-grove 25s ease-in-out infinite alternate;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="400"><rect width="8" height="400" fill="rgba(85,107,47,0.7)" x="10"/><circle cx="14" cy="200" r="5" fill="rgba(60, 90, 60, 0.4)"/><rect width="1" height="80" fill="rgba(0,0,0,0.1)" x="13" y="50"/><rect width="1" height="80" fill="rgba(0,0,0,0.1)" x="13" y="150"/><rect width="1" height="80" fill="rgba(0,0,0,0.1)" x="13" y="250"/><rect width="10" height="400" fill="rgba(85,107,47,0.7)" x="50"/><circle cx="55" cy="120" r="6" fill="rgba(60, 90, 60, 0.4)"/><rect width="1" height="100" fill="rgba(0,0,0,0.1)" x="54" y="80"/><rect width="1" height="100" fill="rgba(0,0,0,0.1)" x="54" y="220"/><rect width="7" height="400" fill="rgba(85,107,47,0.7)" x="85"/><rect width="1" height="70" fill="rgba(0,0,0,0.1)" x="88" y="30"/><rect width="1" height="70" fill="rgba(0,0,0,0.1)" x="88" y="130"/><rect width="1" height="70" fill="rgba(0,0,0,0.1)" x="88" y="230"/><rect width="1" height="70" fill="rgba(0,0,0,0.1)" x="88" y="330"/></svg>');
            background-repeat: repeat-x;
        }
        #bamboo-grove-back { z-index: 2; filter: brightness(0.7); animation-duration: 20s; }
        #bamboo-grove-mid { z-index: 4; filter: brightness(0.85); animation-duration: 25s; }
        #bamboo-grove-front { z-index: 6; filter: brightness(1); animation-duration: 30s; }
        @keyframes sway-grove {
            from { transform: rotate(-1deg); }
            to { transform: rotate(1deg); }
        }

        #bamboo-sun-dapples { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3; mix-blend-mode: overlay; }
        .sun-dapple {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,250,205,0.5) 0%, rgba(255,250,205,0) 60%);
            animation: dapple-shift 15s ease-in-out infinite alternate;
        }
        @keyframes dapple-shift {
            from { transform: translate(-20px, 10px) scale(0.9); opacity: 0.8; }
            to { transform: translate(20px, -10px) scale(1.1); opacity: 1; }
        }

        #bamboo-leaves { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 7; }
        .bamboo-leaf {
            position: absolute;
            width: 10px; height: 40px;
            background-color: #556b2f;
            border-radius: 50% 0;
            animation: fall-bamboo-leaf linear infinite;
        }
        @keyframes fall-bamboo-leaf {
            0% { transform: translateY(-10vh) translateX(0) rotate(-20deg); opacity: 1; }
            100% { transform: translateY(110vh) translateX(var(--x-drift)) rotate(var(--r-end)); opacity: 0; }
        }
        #bamboo-fauna { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; }
        .dragonfly {
            position: absolute;
            width: 30px; height: 2px;
            background-color: #333;
            animation: dragonfly-path 15s ease-in-out infinite;
        }
        .dragonfly::before, .dragonfly::after {
            content: '';
            position: absolute;
            left: 10px;
            width: 10px; height: 15px;
            background-color: rgba(173, 216, 230, 0.7);
            border-radius: 50%;
            animation: flap-wings 0.1s linear infinite;
        }
        .dragonfly::before { top: -15px; }
        .dragonfly::after { bottom: -15px; }

        @keyframes flap-wings {
            from { transform: scaleY(1); }
            to { transform: scaleY(-1); }
        }
        @keyframes dragonfly-path {
            0% { transform: translate(var(--x1), var(--y1)) rotate(0deg); }
            20% { transform: translate(var(--x2), var(--y2)) rotate(10deg); }
            40% { transform: translate(var(--x3), var(--y3)) rotate(-10deg); }
            60% { transform: translate(var(--x4), var(--y4)) rotate(5deg); }
            80% { transform: translate(var(--x5), var(--y5)) rotate(-5deg); }
            100% { transform: translate(var(--x6), var(--y6)) rotate(0deg); }
        }

        #bamboo-path {
            position: absolute;
            bottom: 5%;
            left: 0;
            width: 100%;
            height: 10%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 40"><path d="M 0 20 C 50 0, 150 40, 200 20 S 350 0, 400 20" fill="none" stroke="rgba(0,0,0,0.05)" stroke-width="30"/><path d="M 0 20 C 50 0, 150 40, 200 20 S 350 0, 400 20" fill="none" stroke="rgba(180,180,180,1)" stroke-width="2" stroke-dasharray="10 15"/></svg>');
            background-size: 400px 40px;
            animation: slide 90s linear infinite;
            z-index: 5;
        }
        #bamboo-lantern {
            position: absolute;
            bottom: 15%;
            left: 10%;
            width: 50px;
            height: 80px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 80"><path d="M 10 0 L 40 0 L 45 10 L 5 10 Z M 10 10 L 40 10 L 40 50 L 10 50 Z M 5 50 L 45 50 L 40 60 L 10 60 Z M 20 60 L 30 60 L 30 80 L 20 80 Z" fill="rgba(30,30,20,0.8)"/></svg>');
            z-index: 3;
            filter: blur(1px);
        }

        .bamboo-mist {
            position: absolute; bottom: 0; left: 0;
            width: 100%; height: 20%;
            background: linear-gradient(to top, rgba(216, 226, 220, 0.4) 0%, transparent 100%);
            animation: mist-anim 120s linear infinite alternate;
            z-index: 8;
        }

        /* --- Misty Mountain Lake Theme --- */
        #misty-lake-theme {
            background-color: #a8b2c2; /* Fallback color */
            overflow: hidden;
        }
        .misty-sky {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 50%;
            background: linear-gradient(to top, #b4c5dd, #94a8c2, #7a8fa8);
            z-index: 1;
        }
        #misty-lake-reflection {
            position: absolute; bottom: 0; left: 0;
            width: 100%; height: 50%;
            background: linear-gradient(to bottom, #b4c5dd, #94a8c2, #7a8fa8);
            transform: scaleY(-1);
            z-index: 1;
        }
        .misty-mountains {
            position: absolute; top: 0; left: 0;
            width: 200%; height: 50%;
            background-repeat: repeat-x;
            background-position: 0 bottom;
            animation: slide-misty-lake linear infinite;
            will-change: transform;
        }
        .misty-mountains::after { /* Reflection */
            content: '';
            position: absolute; top: 100%; left: 0;
            width: 100%; height: 100%;
            background-image: var(--reflection-bg);
            background-size: 100% 100%;
            filter: blur(2px) brightness(0.9);
            opacity: 0.8;
        }
        #misty-mountains-back { animation-duration: 300s; z-index: 2; }
        #misty-mountains-mid { animation-duration: 220s; z-index: 3; }
        #misty-mountains-front { animation-duration: 160s; z-index: 4; }

        @keyframes slide-misty-lake {
            from { transform: translateX(0%); }
            to { transform: translateX(-50%); }
        }

        #misty-lake-mist {
            position: absolute; bottom: 45%; left: 0;
            width: 100%; height: 15%;
            z-index: 5;
        }
        .mist-column {
            position: absolute;
            bottom: 0;
            width: 5vw;
            height: 100%;
            background: linear-gradient(to top, rgba(180, 190, 200, 0.4) 0%, transparent 100%);
            animation: rise-mist 40s ease-in-out infinite;
            filter: blur(10px);
        }
        @keyframes rise-mist {
            from { transform: translateY(20%) scaleY(1); opacity: 0; }
            50% { opacity: 0.6; }
            to { transform: translateY(-100%) scaleY(1.5); opacity: 0; }
        }

        .bird-formation {
            position: absolute;
            width: 100%; height: 100%;
            transform: scale(0.3);
            animation: fly-across-sky 80s linear infinite;
        }
        .bird-formation::before {
            content: 'V';
            position: absolute;
            font-size: 50px;
            color: #2c3e50;
            text-shadow: 0 0 5px #2c3e50;
        }
        @keyframes fly-across-sky {
            from { transform: translate(-10vw, var(--y-pos)) scale(0.3) rotate(-5deg); }
            to { transform: translate(110vw, calc(var(--y-pos) - 5vh)) scale(0.3) rotate(5deg); }
        }

        .fish-ripple {
            position: absolute;
            border: 1px solid rgba(200, 210, 220, 0.5);
            border-radius: 50%;
            transform: scale(0);
            animation: expand-fish-ripple ease-out;
        }
        @keyframes expand-fish-ripple {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(1); opacity: 0; width: 100px; height: 30px; }
        }
        #misty-lake-surface {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 6;
        }

        .lake-reed {
            position: absolute;
            width: 3px; height: 50px;
            background: linear-gradient(to top, #4a5a40, #607858);
            border-radius: 2px 2px 0 0;
            transform-origin: bottom center;
            animation: sway-reed 8s ease-in-out infinite alternate;
        }
        .lake-reed::after { /* Reflection */
            content: '';
            position: absolute; top: 100%; left: 0;
            width: 100%; height: 80%;
            background: inherit;
            transform: scaleY(-1);
            filter: blur(1px) brightness(0.8);
            opacity: 0.7;
        }
        @keyframes sway-reed {
            from { transform: rotate(-2deg); }
            to { transform: rotate(2deg); }
        }
        #misty-lake-flora {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 7;
        }

/* --- Simplified Waves Theme --- */
#waves-theme {
    background: linear-gradient(to top, #3a6073, #16222a);
    overflow: hidden;
}
.waves-bg {
    position: absolute; width: 100%; height: 100%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><filter id="f"><feGaussianBlur stdDeviation="2"/></filter><g filter="url(%23f)"><circle cx="20" cy="80" r="30" fill="%233a6073"/><circle cx="80" cy="70" r="40" fill="%2316222a"/></g></svg>');
    background-size: cover;
    filter: blur(5px);
    transform: scale(1.2);
    z-index: 1;
}

.wave-layer {
    position: absolute;
    bottom: 0; left: 0;
    width: 200%; height: 100%;
    background-repeat: repeat-x;
    background-position: 0 bottom;
    animation: slide linear infinite;
    will-change: transform;
    opacity: 0.8;
}

#waves-layer-back {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 100"><path d="M0 50 C 200 20, 400 80, 800 50 L 800 100 L 0 100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
    animation-duration: 45s;
    z-index: 2;
    filter: blur(2px);
}
#waves-layer-mid {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 100"><path d="M0 60 C 250 10, 350 110, 800 60 L 800 100 L 0 100 Z" fill="rgba(255,255,255,0.15)"/></svg>');
    animation-duration: 30s;
    z-index: 4;
    filter: blur(1px);
}
#waves-layer-front {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 100"><path d="M0 70 C 300 -20, 500 120, 800 70 L 800 100 L 0 100 Z" fill="rgba(255,255,255,0.2)"/></svg>');
    animation-duration: 20s;
    z-index: 6;
}

.wave-particle {
    position: absolute;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    animation: wave-particle-drift 15s ease-in-out infinite alternate;
    z-index: 3;
}
@keyframes wave-particle-drift {
    from {
        transform: translate(var(--x-start), var(--y-start));
        opacity: 0;
    }
    50% {
        opacity: 0.8;
    }
    to {
        transform: translate(var(--x-end), var(--y-end));
        opacity: 0;
    }
}

/* --- Meditation Temple Theme --- */
#meditation-temple-theme {
    background-color: #f4f1de;
    overflow: hidden;
}

#meditation-temple-sky {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(to top, #f6e58d, #f9d29d, #f3a683);
    z-index: 1;
}

.meditation-temple-mountain-layer {
    position: absolute;
    bottom: 0; left: 0;
    width: 200%; height: 100%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600"><path d="M 0 600 L 150 300 L 300 450 L 500 200 L 650 500 L 800 350 V 600 Z" fill="rgba(60,50,40,0.3)"/></svg>');
    animation: slide linear infinite;
}

#meditation-temple-mountains-back { animation-duration: 250s; z-index: 2; filter: brightness(0.7); }
#meditation-temple-mountains-mid { animation-duration: 180s; z-index: 3; filter: brightness(0.85); }
#meditation-temple-mountains-front { animation-duration: 120s; z-index: 8; }

#meditation-temple-main {
    position: absolute;
    bottom: 20%; left: 50%;
    transform: translateX(-50%);
    width: 400px; height: 300px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><path d="M 200 50 L 350 150 L 320 150 L 320 280 L 80 280 L 80 150 L 50 150 Z" fill="rgba(40,30,20,0.8)"/><path d="M 200 20 L 380 130 L 20 130 Z" fill="rgba(40,30,20,0.8)"/><rect x="180" y="180" width="40" height="100" fill="rgba(20,10,5,0.9)"/></svg>');
    z-index: 5;
}

#meditation-temple-trees {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 6;
}

#meditation-temple-prayer-flags {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 7;
}

.prayer-flag-strand {
    position: absolute;
    height: 30px;
    transform-origin: top left;
}

.prayer-flag {
    position: absolute;
    top: 0;
    width: 20px; height: 25px;
    transform-origin: top center;
    animation: flutter-flag 4s ease-in-out infinite;
}

@keyframes flutter-flag {
    from { transform: rotate(5deg) skewX(-10deg); }
    to { transform: rotate(-5deg) skewX(10deg); }
}

#meditation-temple-incense {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 9;
    mix-blend-mode: screen;
}

.temple-incense-wisp {
    position: absolute;
    width: 3px;
    height: 80%;
    background: linear-gradient(to top, rgba(220, 210, 200, 0.3), transparent);
    animation: rise-and-sway-smoke ease-in-out infinite;
}

@keyframes rise-and-sway-smoke {
    0% { transform: translateY(0) translateX(0) scale(1); opacity: 0; }
    20% { opacity: 1; }
    100% { transform: translateY(-80vh) translateX(50px) scale(3); opacity: 0; }
}

.temple-bell-glint {
    position: absolute;
    width: 5px; height: 5px;
    background-color: #fbc531;
    border-radius: 50%;
    box-shadow: 0 0 10px #fbc531, 0 0 15px #fbc531;
    animation: glint-bell 10s ease-in-out infinite;
}

@keyframes glint-bell {
    0%, 100% { opacity: 0; }
    5% { opacity: 0.8; }
    10% { opacity: 0; }
}

.prayer-wheel {
    position: absolute;
    width: 40px; height: 60px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 60"><rect x="0" y="5" width="40" height="50" fill="%23c0955d" stroke="%238b5e34" stroke-width="2"/><rect x="18" y="0" width="4" height="60" fill="%235a3d2b"/></svg>');
    animation: spin-wheel 15s linear infinite;
}

@keyframes spin-wheel {
    from { transform: rotateY(0deg); }
    to { transform: rotateY(360deg); }
}

.temple-bell {
    position: absolute;
    width: 30px; height: 40px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 40"><path d="M 5 0 L 25 0 L 30 20 A 15 15 0 0 1 0 20 L 5 0 Z" fill="%23fbc531"/></svg>');
    transform-origin: top center;
    animation: sway-bell 8s ease-in-out infinite alternate;
}

@keyframes sway-bell {
    from { transform: rotate(3deg); }
    to { transform: rotate(-3deg); }
}

.monk-silhouette {
    position: absolute;
    width: 20px; height: 35px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 35"><path d="M 10 0 A 5 5 0 0 0 10 10 L 12 25 L 8 25 L 10 10 M 5 25 L 15 25 L 12 35 L 8 35 Z" fill="rgba(20,10,5,0.7)"/></svg>');
    opacity: 0.6;
}

/* --- Moonlit Greenhouse Theme --- */
#moonlit-greenhouse-theme {
    background-color: #0c141f;
    overflow: hidden;
}

#greenhouse-sky {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(to top, #0d1b2a, #1b263b, #415a77);
    z-index: 1;
}

#greenhouse-moon {
    position: absolute;
    top: 10%; right: 15%;
    width: 100px; height: 100px;
    background-color: #f7f3e3;
    border-radius: 50%;
    box-shadow: 0 0 40px #f7f3e3, 0 0 80px #f7f3e3;
    animation: moon-pulse 10s ease-in-out infinite alternate;
    z-index: 2;
}

#greenhouse-framework {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-image:
        linear-gradient(rgba(200, 210, 220, 0.1) 1px, transparent 1px),
        linear-gradient(to right, rgba(200, 210, 220, 0.1) 1px, transparent 1px);
    background-size: 100px 100px;
    z-index: 5;
    --moonbeam-x: 80%;
    --moonbeam-y: 15%;
}

#greenhouse-framework::after { /* Moonbeam */
    content: '';
    position: absolute;
    top: -50%; left: var(--moonbeam-x);
    width: 20%;
    height: 200%;
    background: linear-gradient(to bottom, rgba(247, 243, 227, 0.15) 0%, transparent 80%);
    transform: rotate(-30deg);
    transform-origin: top center;
    animation: moonbeam-sway 20s ease-in-out infinite alternate;
}

@keyframes moonbeam-sway {
    from { transform: rotate(-35deg) scaleY(1); }
    to { transform: rotate(-25deg) scaleY(1.05); }
}

.greenhouse-plant-layer {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%; height: 100%;
    will-change: transform;
}
#greenhouse-plants-back { z-index: 3; filter: blur(1px) brightness(0.8); }
#greenhouse-plants-mid { z-index: 6; }
#greenhouse-plants-front { z-index: 8; filter: brightness(1.2); }

.greenhouse-plant {
    position: absolute;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: bottom center;
    animation: plant-sway 10s ease-in-out infinite alternate;
}

@keyframes plant-sway {
    from { transform: rotate(-2deg); }
    to { transform: rotate(2deg); }
}

#greenhouse-dewdrops {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 7;
}

.dewdrop {
    position: absolute;
    width: 4px; height: 4px;
    background: #e0fbfc;
    border-radius: 50%;
    box-shadow: 0 0 8px #e0fbfc, 0 0 12px #98c1d9;
    animation: dewdrop-glisten 8s ease-in-out infinite alternate;
}

@keyframes dewdrop-glisten {
    from { opacity: 0.3; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
}

#greenhouse-mist {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%; height: 25%;
    background: linear-gradient(to top, rgba(120, 140, 160, 0.2), transparent);
    z-index: 4;
    animation: mist-anim 80s linear infinite alternate;
}

#greenhouse-moths {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 9;
}
.greenhouse-moth {
    position: absolute;
    width: 15px; height: 15px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M 10 10 C 0 0, 20 0, 10 10 M 10 10 C 0 20, 20 20, 10 10" fill="rgba(247, 243, 227, 0.6)"/></svg>');
    animation: flutter-moth-greenhouse 15s ease-in-out infinite;
}

@keyframes flutter-moth-greenhouse {
    0% { transform: translate(var(--x-start), var(--y-start)) rotate(0deg); }
    50% { transform: translate(var(--x-end), var(--y-end)) rotate(360deg); }
    100% { transform: translate(var(--x-start), var(--y-start)) rotate(0deg); }
}

/* --- Ice Temple Theme --- */
#ice-temple-theme {
    background: linear-gradient(to top, #3a7bd5, #3a6073, #16222a);
    overflow: hidden;
}

#ice-temple-sky {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 1;
}

#ice-temple-aurora {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 2;
    mix-blend-mode: screen;
    opacity: 0.7;
}
.ice-aurora-curtain {
    position: absolute;
    top: -50%; left: -25%;
    width: 150%; height: 200%;
    background: radial-gradient(ellipse at center, transparent 0%, transparent 40%, var(--aurora-color) 100%);
    animation: aurora-curtain-flow 30s ease-in-out infinite alternate;
}

#ice-temple-waterfalls {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 4;
}
.frozen-waterfall {
    position: absolute;
    top: 0;
    width: 80px;
    height: 100%;
    background: linear-gradient(to bottom, rgba(200, 220, 255, 0) 0%, rgba(200, 220, 255, 0.4) 50%, rgba(200, 220, 255, 0) 100%);
    clip-path: polygon(20% 0, 80% 0, 100% 100%, 0% 100%);
    animation: shimmer-ice 10s ease-in-out infinite alternate;
}

@keyframes shimmer-ice {
    from { opacity: 0.6; }
    to { opacity: 0.9; }
}

#ice-temple-sculptures {
    position: absolute;
    bottom: 5%; left: 0;
    width: 100%; height: 30%;
    z-index: 6;
    display: flex;
    justify-content: space-around;
    align-items: flex-end;
}

#ice-temple-refractions {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 7; /* On top of most elements */
    mix-blend-mode: screen;
    pointer-events: none;
}

.ice-refraction-ray {
    position: absolute;
    width: 1px;
    height: 150px;
    background: linear-gradient(to bottom, transparent, #74b9ff, #a29bfe, #55efc4, #ff7675, #fdcb6e, transparent);
    animation: ice-refraction-shimmer 10s ease-in-out infinite;
    opacity: 0;
}

@keyframes ice-refraction-shimmer {
    0%, 100% { opacity: 0; }
    5% { opacity: 0.4; }
    10% { opacity: 0; }
}

.ice-sculpture {
    width: 150px; height: 150px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    filter: drop-shadow(0 0 15px rgba(173, 216, 230, 0.7));
    animation: shimmer-ice 8s ease-in-out infinite alternate-reverse;
}

/* --- Himalayan Peak Theme --- */
#himalayan-peak-theme {
    background-color: #a7c5d9;
    overflow: hidden;
}

#himalayan-sky {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(to top, #74a8c3, #a7c5d9, #d3e0ea);
    z-index: 1;
}

#himalayan-sun {
    position: absolute;
    top: 10%; left: 50%;
    transform: translateX(-50%);
    width: 150px; height: 150px;
    background: radial-gradient(circle, #fff, #fff2d9, #ffefc4);
    border-radius: 50%;
    box-shadow: 0 0 80px #fff;
    animation: sun-pulse 12s ease-in-out infinite alternate;
    z-index: 2;
}

#himalayan-clouds {
    position: absolute;
    top: 0; left: 0;
    width: 200%; height: 100%;
    animation: slide 150s linear infinite;
    z-index: 4;
}
.himalayan-cloud {
    position: absolute;
    width: 400px; height: 100px;
    background: rgba(255, 255, 255, 0.4);
    border-radius: 50px;
    filter: blur(30px);
}

#himalayan-flags {
    position: absolute;
    top: 40%; left: 0;
    width: 100%;
    z-index: 6;
}
.himalayan-prayer-strand {
    position: absolute;
    width: 100%;
    height: 30px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 2"><path d="M 0 1 C 25 2, 75 0, 100 1" fill="none" stroke="rgba(40,30,20,0.5)" stroke-width="0.5"/></svg>');
    background-size: 100px 2px;
}
.himalayan-prayer-flag {
    position: absolute;
    top: 1px;
    width: 15px; height: 20px;
    transform-origin: top center;
    animation: flutter-flag 3s ease-in-out infinite;
}

#himalayan-sun-rays {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 3; /* Between sky and clouds */
    transform-origin: 50% 15%; /* Centered on the sun */
    animation: sun-ray-pan 90s ease-in-out infinite alternate;
    mix-blend-mode: screen;
}

@keyframes sun-ray-pan {
    from { transform: rotate(-15deg); }
    to { transform: rotate(15deg); }
}

.himalayan-sun-ray {
    position: absolute;
    top: 0; left: 50%;
    width: 2px;
    height: 120%;
    background: linear-gradient(to bottom, rgba(255, 255, 240, 0.2), transparent 70%);
    transform-origin: top center;
    animation: sun-ray-fade 12s ease-in-out infinite;
}

@keyframes sun-ray-fade {
    0%, 100% { opacity: 0; }
    50% { opacity: 1; }
}

#himalayan-particles {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 8;
}
@keyframes slide {
            from { transform: translateX(0%); }
            to { transform: translateX(-50%); }
        }

        .game-container {
            display: flex;
            gap: 30px;
            padding: 20px;
            animation: fadeIn 0.5s ease;
            position: relative;
            z-index: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .game-area { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .next-pieces-container {
            display: flex; gap: 15px; align-items: flex-end; padding: 15px;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px);
            border: 2px solid #8b5cf6; border-radius: 12px; min-height: 80px;
        }
        .next-piece-box { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .next-piece-box.main { transform: scale(1.2); margin-right: 10px; }
        .next-piece-label { font-size: 10px; color: #a78bfa; text-transform: uppercase; font-weight: bold; }
        .next-piece-box canvas { background: rgba(0, 0, 0, 0.3); border-radius: 6px; padding: 4px; border: 1px solid rgba(139, 92, 246, 0.3); }
        .next-piece-box.main canvas { border: 2px solid rgba(0, 255, 255, 0.5); box-shadow: 0 0 10px rgba(0, 255, 255, 0.3); }

        #game-canvas {
            border: 4px solid #8b5cf6;
            border-radius: 12px;
            background: rgba(26, 26, 46, 0.8);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.5), 0 0 60px rgba(139, 92, 246, 0.3), 0 0 90px rgba(139, 92, 246, 0.1);
        }

        .sidebar { display: flex; flex-direction: column; gap: 20px; }
        .panel {
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px); border: 2px solid #8b5cf6;
            border-radius: 12px; padding: 20px; min-width: 180px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .panel h2 {
            font-family: 'Orbitron', sans-serif; font-weight: 700; color: #00ffff; font-size: 18px;
            margin-bottom: 15px; text-align: center; text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }
        .stat-label { color: #a78bfa; font-weight: 400; }
        .stat-value { color: #ffffff; font-weight: 700; }
        .stat-value.danger { color: #ef4444; text-shadow: 0 0 5px rgba(239, 68, 68, 0.5); animation: pulse 0.5s infinite; }
        .stat-value.warning { color: #fbbf24; text-shadow: 0 0 5px rgba(251, 191, 36, 0.5); }
        .controls-info { font-size: 12px; color: #a78bfa; }
        .controls-info div { margin-bottom: 5px; }
        .action-btn {
            background: #8b5cf6; border: none; color: white; padding: 10px; border-radius: 8px;
            cursor: pointer; font-size: 16px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            text-align: center;
        }
        .action-btn:hover { background: #7c3aed; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6); }

        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center; background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px); opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 1000;
        }
        .modal.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(0, 255, 255, 0.1)); border: 3px solid;
            border-radius: 20px; padding: 40px; text-align: center; box-shadow: 0 0 50px rgba(139, 92, 246, 0.5); color: #e0e7ff;
        }
        .modal h1 {
            font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 48px;
            margin-bottom: 20px; text-shadow: 0 0 20px currentColor;
        }
        #start-modal .modal-content { border-color: #00ffff; }
        #start-modal h1 { background: linear-gradient(45deg, #00ffff, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        #game-over-modal .modal-content, #settings-modal .modal-content { border-color: #8b5cf6; }
        #game-over-modal h1, #settings-modal h1 { color: #00ffff; }
        .modal p { font-size: 18px; animation: pulse 2s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; } 50% { opacity: 0.5; }
        }

        .settings-grid { display: grid; grid-template-columns: auto 1fr; gap: 15px 20px; margin: 20px 0; text-align: left; align-items: center; }
        .setting { display: contents; }
        .setting label { justify-self: end; align-self: center; }
        .key-input, .setting-select {
            background: rgba(0,0,0,0.3); border: 1px solid #8b5cf6; color: white; padding: 8px; border-radius: 5px;
            text-align: center; cursor: pointer; width: 150px; justify-self: start;
        }
        .setting-select {
            text-align: left; -webkit-appearance: none; -moz-appearance: none; appearance: none;
            padding-right: 30px;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 8px center; background-size: 1em;
        }
        .key-input.listening { border-color: #fbbf24; box-shadow: 0 0 10px #fbbf24; }
        .slider-container { display: flex; align-items: center; gap: 10px; }
        .slider-container input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; cursor: pointer; background: transparent; }
        .slider-container input[type=range]::-webkit-slider-runnable-track { background: rgba(0,0,0,0.5); height: 8px; border-radius: 4px; }
        .slider-container input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; margin-top: -4px;
            background-color: #8b5cf6; height: 16px; width: 16px; border-radius: 50%;
        }

        .score-popup { position: absolute; color: #fbbf24; font-weight: bold; font-size: 24px; pointer-events: none; animation: scorePop 1s ease-out forwards; }
        @keyframes scorePop {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -150%) scale(1.5); opacity: 0; }
        }

        .line-flash { animation: flash 0.5s ease; }
        @keyframes flash {
            0%, 100% { filter: brightness(1); } 50% { filter: brightness(2); }
        }

        @media (max-width: 768px) {
            body {
                overflow-y: auto;
                align-items: flex-start;
                padding: 10px;
                padding-bottom: env(safe-area-inset-bottom); /* Add safe area padding */
            }

            .game-container {
                flex-direction: column;
                align-items: center;
                width: 100%;
                gap: 15px;
                padding: 0;
            }

            .game-area {
                order: -1; /* Game area at the top */
            }

            .next-pieces-container {
                flex-wrap: wrap;
                justify-content: center;
                max-width: 100%;
                padding: 8px;
                gap: 8px;
                min-height: auto;
                border-width: 2px;
            }

            .next-piece-box.main {
                transform: none;
                margin-right: 0;
            }

            .sidebar {
                order: 1; /* Sidebar at the bottom */
                width: 100%;
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                grid-template-areas:
                    "stats stats stats stats"
                    "btn1  btn2  btn3  btn4";
                gap: 10px;
            }

            .sidebar .panel {
                background: transparent;
                border: none;
                box-shadow: none;
                padding: 0;
            }

            .sidebar .panel:nth-of-type(1) {
                grid-area: stats;
                display: flex;
                flex-wrap: wrap;
                justify-content: space-around;
                background: rgba(0, 0, 0, 0.6);
                border: 2px solid #8b5cf6;
                border-radius: 12px;
                padding: 5px;
            }

            .sidebar .panel:nth-of-type(2) {
                display: none; /* Hide controls panel on mobile */
            }

            .sidebar .panel h2 {
                display: none;
            }

            .stat-row {
                font-size: 12px;
                flex: 1 1 auto;
                padding: 5px;
                text-align: center;
                display: flex;
                flex-direction: column;
                gap: 4px;
                margin-bottom: 0; /* Override default margin */
            }

            .stat-label {
                font-size: 10px;
                order: 1;
            }

            #sound-toggle { grid-area: btn1; }
            #next-track-btn { grid-area: btn2; }
            #fullscreen-toggle { grid-area: btn3; }
            #settings-btn { grid-area: btn4; }

            .action-btn {
                padding: 15px 10px;
                font-size: 24px;
                min-height: 60px;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .modal-content {
                padding: 20px;
                width: 95%;
                max-height: 85dvh;
                display: flex;
                flex-direction: column;
            }

            .modal h1 {
                font-size: 36px;
                flex-shrink: 0; /* Prevent title from shrinking */
            }

            .settings-scroll-container {
                overflow-y: auto; /* Enable vertical scrolling */
                flex-grow: 1; /* Allow container to fill available space */
                margin: 20px 0;
                padding-right: 15px; /* Add space for scrollbar */
                 -webkit-overflow-scrolling: touch; /* Momentum scrolling for iOS */
            }

            /* Custom Scrollbar for Webkit browsers */
            .settings-scroll-container::-webkit-scrollbar {
                width: 8px;
            }

            .settings-scroll-container::-webkit-scrollbar-track {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 4px;
            }

            .settings-scroll-container::-webkit-scrollbar-thumb {
                background: #8b5cf6;
                border-radius: 4px;
                border: 1px solid rgba(0,0,0,0.5);
            }

            .settings-scroll-container::-webkit-scrollbar-thumb:hover {
                background: #7c3aed;
            }

            #settings-modal .action-btn {
                flex-shrink: 0; /* Prevent close button from shrinking */
            }

            .modal p {
                font-size: 16px;
            }

            .settings-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .setting label {
                justify-self: start;
                font-size: 14px;
            }

            .key-input, .setting-select, .slider-container {
                width: 100%;
                justify-self: start;
            }

            .key-input, .setting-select {
                padding: 12px;
                font-size: 16px;
            }
        }

/* --- Fluid Dreams Theme --- */
#fluid-dreams-theme {
    background: linear-gradient(217deg, rgba(6, 2, 23,1), rgba(3, 1, 12,1) 35.71%, rgba(24, 2, 64,1) 100%);
    overflow: hidden;
    filter: blur(0.5px) saturate(1.2);
}

/* Gooey/Mercury Effect Container */
#morphing-blobs {
    width: 100%;
    height: 100%;
    filter: url(#gooey-blobs); /* SVG filter for the merge effect */
}

.morph-blob {
    position: absolute;
    border-radius: 50%;
    background: linear-gradient(45deg, #7b42f5, #b47ffc, #ff6b81, #ffa500);
    background-size: 400% 400%;
    animation:
        morph-shape 20s ease-in-out infinite alternate,
        move-blob 30s ease-in-out infinite alternate,
        change-color 15s ease-in-out infinite alternate;
}

@keyframes morph-shape {
    0% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
    50% { border-radius: 60% 40% 30% 70% / 50% 60% 50% 40%; }
    100% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
}

@keyframes move-blob {
    from { transform: translate(var(--x-start), var(--y-start)) rotate(0deg) scale(var(--scale-start)); }
    to { transform: translate(var(--x-end), var(--y-end)) rotate(360deg) scale(var(--scale-end)); }
}

@keyframes change-color {
    0%{ background-position: 0% 50% }
    50%{ background-position: 100% 50% }
    100%{ background-position: 0% 50% }
}

/* Iridescent Bubbles */
.iridescent-bubble {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0)),
                radial-gradient(circle at 70% 80%, #a29bfe, #74b9ff, rgba(0,0,0,0));
    box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.3);
    animation: float-bubble 25s ease-in-out infinite alternate;
    mix-blend-mode: screen;
}

@keyframes float-bubble {
    from {
        transform: translate(var(--x-start), var(--y-start)) scale(var(--scale));
        opacity: 0;
    }
    10% { opacity: 0.8; }
    90% { opacity: 0.8; }
    to {
        transform: translate(var(--x-end), var(--y-end)) scale(var(--scale));
        opacity: 0;
    }
}

/* Flowing Ribbons */
.ribbon-stream {
    position: absolute;
    width: 80px;
    height: 300px;
    opacity: 0.3;
    filter: blur(10px);
    background: linear-gradient(45deg, #00ff99, #66ccff, #ff66cc, #ffc300, #00ff99);
    background-size: 100% 400%;
    animation:
        flow-ribbon-path 40s ease-in-out infinite alternate,
        flow-ribbon-color 10s linear infinite;
}

@keyframes flow-ribbon-path {
    from { transform: translate(var(--x-start), var(--y-start)) rotate(var(--r-start)) skew(20deg, -10deg); }
    to { transform: translate(var(--x-end), var(--y-end)) rotate(var(--r-end)) skew(-10deg, 20deg); }
}

@keyframes flow-ribbon-color {
    from { background-position: 0% 0%; }
    to { background-position: 0% 400%; }
}

/* Dimensional Warp Overlay */
.dimensional-warp {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    opacity: 0.2;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="warp"><feTurbulence type="fractalNoise" baseFrequency="0.005 0.009" numOctaves="2" result="turbulence"/><feDisplacementMap in2="turbulence" in="SourceGraphic" scale="20" xChannelSelector="R" yChannelSelector="G"/></filter><rect width="200" height="200" fill="transparent" filter="url(%23warp)"/></svg>');
    animation: warp-pan 25s linear infinite alternate;
}

@keyframes warp-pan {
    from { background-position: 0% 0%; }
    to { background-position: 100% 100%; }
}

/* --- Lantern Festival Theme --- */
#lantern-festival-theme {
    overflow: hidden;
}
.lantern-sky {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(to top, #2c1e3a, #4a3a60, #7b526f 70%, #a86c7f 100%);
    z-index: 1;
}
#lantern-mountains {
    position: absolute;
    bottom: 10%; left: 0;
    width: 100%; height: 25%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 120"><path d="M 0 120 Q 150 20, 400 100 T 800 80 L 800 120 L 0 120 Z" fill="rgba(10, 5, 15, 0.6)"/></svg>');
    background-size: 100% 100%;
    z-index: 2;
    filter: brightness(0.8);
}
#lantern-silhouettes {
    position: absolute;
    bottom: 10%; left: 0;
    width: 200%; height: 30%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 240"><path d="M50 240 L50 180 L0 180 L25 150 L25 120 L75 120 L75 150 L100 180 L50 180 M200 240 L200 150 Q250 120 300 150 L300 240 Z M240 150 L240 120 L260 120 L260 150 Z M400 240 L380 100 L420 100 L400 240 M450 240 L450 80 L550 80 L550 240 M470 70 A30 30 0 0 1 530 70 Z M600 240 L600 180 L650 120 L700 180 L700 240 Z" fill="rgba(20, 10, 30, 0.7)"/></svg>');
    animation: slide 250s linear infinite;
    z-index: 3;
}

.lantern-layer {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
}
#lanterns-back { z-index: 4; transform: scale(0.6); filter: blur(2px) brightness(0.9); }
#lanterns-mid { z-index: 6; }
#lanterns-front { z-index: 8; transform: scale(1.2); filter: brightness(1.1); }

.lantern {
    position: absolute;
    bottom: -150px; /* Start below screen */
    background-size: contain;
    background-repeat: no-repeat;
    animation: float-lantern ease-in-out infinite;
}
.lantern::after { /* The glow */
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 150%; height: 150%;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 180, 100, 0.4) 0%, transparent 70%);
    animation: pulse-glow 5s ease-in-out infinite alternate;
    z-index: -1;
}

@keyframes float-lantern {
    0% {
        transform: translateY(0) translateX(var(--x-sway1)) rotate(-2deg);
        opacity: var(--start-opacity);
    }
    100% {
        transform: translateY(-120vh) translateX(var(--x-sway2)) rotate(2deg);
        opacity: 0;
    }
}

#lantern-water {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%; height: 12%;
    background: linear-gradient(to top, rgba(44, 30, 58, 0.7), transparent);
    z-index: 10;
    overflow: hidden;
}
.lantern-reflection {
    position: absolute;
    bottom: 100%; /* Positioned above the water line to reflect downwards */
    background: radial-gradient(ellipse, rgba(255, 180, 100, 0.5) 20%, transparent 70%);
    border-radius: 50%;
    animation: float-lantern ease-in-out infinite, shimmer-reflection 4s ease-in-out infinite alternate;
}

@keyframes shimmer-reflection {
    from { transform: scale(1, 0.4) skewX(10deg); opacity: 0.5; }
    to { transform: scale(1, 0.3) skewX(-10deg); opacity: 0.3; }
}

.lantern-petal {
    position: absolute;
    width: 15px; height: 15px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 0 C5 5, 5 15, 10 20 C15 15, 15 5, 10 0 Z" fill="rgba(255, 180, 200, 0.7)"/></svg>');
    background-size: contain;
    animation: drift-petal linear infinite;
    z-index: 7;
}

@keyframes drift-petal {
    from { transform: translate(var(--x-start), var(--y-start)) rotate(var(--r-start)); }
    to { transform: translate(var(--x-end), var(--y-end)) rotate(var(--r-end)); }
}

.lantern-ember {
    position: absolute;
    width: 3px; height: 3px;
    background-color: rgba(255, 165, 0, 0.8);
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(255, 165, 0, 0.6);
    animation: rise-ember linear infinite;
    z-index: 5;
}
@keyframes rise-ember {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-100vh) scale(0.5); opacity: 0; }
}

/* --- Crystal Cave Theme --- */
#crystal-cave-theme {
    background: linear-gradient(to top, #1a182a, #2c2a3e, #4a485e);
    overflow: hidden;
}

#crystal-cave-pools {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%; height: 20%;
    background: linear-gradient(to top, rgba(70, 90, 140, 0.5), transparent);
    z-index: 3;
    filter: blur(2px);
}
#crystal-cave-pools::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(175deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 5%);
    animation: shimmer-water 12s ease-in-out infinite alternate;
    transform: scaleY(-1); /* Reflect the shimmer */
}


#crystal-cave-moss {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 4;
}
.moss-patch {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(85, 239, 196, 0.3) 0%, transparent 70%);
    box-shadow: 0 0 20px rgba(85, 239, 196, 0.2);
    animation: moss-breathe 8s ease-in-out infinite alternate;
}
@keyframes moss-breathe {
    from { transform: scale(1); opacity: 0.5; }
    to { transform: scale(1.1); opacity: 0.7; }
}

#crystal-cave-glow-clusters {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 6;
}
.crystal-cluster {
    position: absolute;
    border-radius: 50%;
    background-color: var(--glow-color);
    box-shadow: 0 0 30px var(--glow-color), 0 0 50px var(--glow-color);
    animation: cluster-pulse 6s ease-in-out infinite alternate;
}
@keyframes cluster-pulse {
    from { transform: scale(0.9); opacity: 0.7; }
    to { transform: scale(1.1); opacity: 1; }
}

#crystal-cave-refractions {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 9;
    mix-blend-mode: screen;
    pointer-events: none;
}
.refraction-ray {
    position: absolute;
    width: 2px;
    height: 300px;
    background: linear-gradient(to bottom, transparent, red, orange, yellow, green, blue, indigo, violet, transparent);
    animation: refraction-shimmer 12s ease-in-out infinite alternate;
}
@keyframes refraction-shimmer {
    from { opacity: 0; transform: scaleY(0.5) rotate(var(--r-start)); }
    50% { opacity: 0.2; }
    to { opacity: 0; transform: scaleY(1) rotate(var(--r-end)); }
}

/* --- Candlelit Monastery Theme --- */
#candlelit-monastery-theme {
    background: linear-gradient(to top, #1a120a, #3a2a1a, #5a4a3a);
    overflow: hidden;
}

#monastery-candles {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%; height: 40%;
    z-index: 7;
}

.monastery-candle {
    position: absolute;
    width: 10px;
    background: linear-gradient(to right, #f0e0d0, #c0b0a0);
    border-radius: 2px 2px 0 0;
    filter: drop-shadow(0 0 5px rgba(255,165,0,0.3));
    animation: candle-sway 6s ease-in-out infinite alternate;
}

@keyframes candle-sway {
    from { transform: rotate(-0.5deg); }
    to { transform: rotate(0.5deg); }
}

.candle-flame {
    position: absolute;
    top: -15px; left: 50%;
    transform: translateX(-50%);
    width: 12px; height: 18px;
    background: radial-gradient(circle, white 20%, #ffab40 50%, transparent 70%);
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    animation: flicker 1.5s ease-in-out infinite alternate;
}

@keyframes flicker {
    0% { transform: translateX(-50%) scaleY(1) scaleX(1) rotate(2deg); opacity: 0.9; }
    50% { transform: translateX(-50%) scaleY(0.95) scaleX(1.05) rotate(-2deg); opacity: 1; }
    100% { transform: translateX(-50%) scaleY(1.05) scaleX(0.95) rotate(2deg); opacity: 0.9; }
}

#monastery-stained-glass-light {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 3;
    pointer-events: none;
    mix-blend-mode: color-dodge;
}

.stained-glass-beam {
    position: absolute;
    top: -10%; left: 10%;
    width: 30%; height: 120%;
    background: linear-gradient(45deg, rgba(255, 0, 0, 0.2), rgba(255, 255, 0, 0.2), rgba(0, 0, 255, 0.2));
    transform: rotate(25deg);
    animation: light-beam-pan 60s ease-in-out infinite alternate;
}

@keyframes light-beam-pan {
    from { transform: rotate(25deg) translateX(-10vw); }
    to { transform: rotate(20deg) translateX(10vw); }
}

#monastery-shadows {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 1;
    opacity: 0.3;
}

.dancing-shadow {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.5) 100%);
    animation: shadow-dance 6s ease-in-out infinite alternate;
}

@keyframes shadow-dance {
    from { transform: scale(1.5); opacity: 0.8; }
    to { transform: scale(1.6); opacity: 1; }
}

#monastery-benches {
    position: absolute;
    bottom: 0; left: 0;
    width: 200%; height: 15%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 60"><rect x="20" y="20" width="150" height="10" fill="rgba(10,5,0,0.9)"/><rect x="30" y="30" width="10" height="20" fill="rgba(10,5,0,0.9)"/><rect x="150" y="30" width="10" height="20" fill="rgba(10,5,0,0.9)"/><rect x="220" y="20" width="150" height="10" fill="rgba(10,5,0,0.9)"/><rect x="230" y="30" width="10" height="20" fill="rgba(10,5,0,0.9)"/><rect x="350" y="30" width="10" height="20" fill="rgba(10,5,0,0.9)"/></svg>');
    animation: slide 150s linear infinite;
    z-index: 8;
}

/* --- Cherry Blossom Garden Theme --- */
#cherry-blossom-garden-theme {
    background: #007FFF; /* Vibrant blue fallback */
    overflow: hidden;
    position: relative;
}

#cherry-blossom-sky {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(to bottom, #42a5f5 0%, #0077c2 100%);
    animation: none; /* Remove shifting animation */
    z-index: 1;
}

#cherry-blossom-sun {
    display: none; /* Remove sun */
}

#cherry-blossom-clouds {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 3;
}

/* New cartoon-style clouds */
.cherry-blossom-cloud {
    position: absolute;
    left: -20%;
    width: 200px; height: 60px;
    background: #fff;
    border-radius: 60px;
    opacity: 0.95;
    animation: cherry-cloud-drift var(--cloud-duration, 55s) linear infinite;
    transform: scale(var(--cloud-scale, 1));
}

.cherry-blossom-cloud::before,
.cherry-blossom-cloud::after {
    content: '';
    position: absolute;
    background: #fff;
    border-radius: 50%;
}

.cherry-blossom-cloud::before {
    width: 100px; height: 100px;
    top: -50px;
    left: 15px;
}

.cherry-blossom-cloud::after {
    width: 120px; height: 120px;
    top: -55px;
    right: 10px;
}

/* New distant mountains */
#cherry-blossom-hills {
    position: absolute;
    bottom: 25%;
    left: 0;
    width: 100%;
    height: 20%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 120"><path d="M0 120 L0 80 C 150 40, 250 100, 400 70 C 550 40, 650 110, 800 80 L 800 120 Z" fill="rgba(128, 186, 233, 0.4)"/><path d="M0 120 L0 90 C 100 60, 200 110, 350 90 C 500 70, 600 120, 800 100 L 800 120 Z" fill="rgba(128, 186, 233, 0.6)"/></svg>');
    background-size: 100% 100%;
    z-index: 2;
    filter: none;
    opacity: 1;
}

#cherry-blossom-haze {
    display: none; /* Remove haze for crisp look */
}

#cherry-blossom-branches {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 6;
    transform-origin: bottom center;
    animation: gentle-sway 14s ease-in-out infinite alternate;
}

#cherry-blossom-leaves {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 10;
}

.cherry-leaf {
    position: absolute;
    width: var(--leaf-size, 20px);
    height: var(--leaf-size, 20px);
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 2.5C11.8 4.2 14.3 4.8 16.5 4.2C17.7 5.8 17.8 7.8 16.9 9.4C17.8 10.9 17.5 12.9 16.2 14.1C14.5 14.8 12.5 14.3 11 15.5C9.2 13.8 6.7 13.2 4.5 13.8C3.3 12.2 3.2 10.2 4.1 8.6C3.2 7.1 3.5 5.1 4.8 3.9C6.5 3.2 8.5 3.7 10 2.5Z" fill="%23ff8fab"/></svg>');
    background-size: contain;
    background-repeat: no-repeat;
    animation: drift-leaf linear infinite;
    filter: drop-shadow(0 0 3px rgba(220, 80, 120, 0.4));
}

@keyframes drift-leaf {
    0% {
        transform: translateY(var(--y-start)) translateX(var(--x-start)) rotate(var(--r-start));
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    90% {
        opacity: 1;
    }
    100% {
        transform: translateY(var(--y-end)) translateX(var(--x-end)) rotate(var(--r-end));
        opacity: 0;
    }
}

/* New grassy field ground */
#cherry-blossom-ground {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%; height: 30%;
    background: linear-gradient(to top, #4CAF50, #81C784);
    z-index: 3;
    overflow: hidden;
}

/* Winding path added with a pseudo-element */
#cherry-blossom-ground::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 240"><path d="M -50 240 C 200 200, 400 280, 600 180 S 900 100, 850 240" fill="none" stroke="%23A1887F" stroke-width="35"/><path d="M -50 240 C 200 200, 400 280, 600 180 S 900 100, 850 240" fill="none" stroke="%23D7CCC8" stroke-width="25"/></svg>');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    z-index: 4;
}

@keyframes gentle-sway {
    from { transform: rotate(-0.6deg) translateX(-1.2%); }
    to { transform: rotate(0.6deg) translateX(1.2%); }
}

@keyframes cherry-sky-shift {
    from { background: linear-gradient(180deg, #ffe7f4 0%, #ffd4dd 45%, #f6f6ff 100%); }
    to { background: linear-gradient(180deg, #fce3ff 0%, #ffd7e1 50%, #f1f5ff 100%); }
}

@keyframes cherry-cloud-drift {
    from { transform: translateX(-30vw) scale(var(--cloud-scale, 1)); }
    to { transform: translateX(120vw) scale(var(--cloud-scale, 1)); }
}

@keyframes cherry-sun-float {
    0%, 100% { transform: translate3d(-2%, 0, 0) scale(1); }
    50% { transform: translate3d(4%, 3%, 0) scale(1.05); }
}

@keyframes cherry-haze-pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 0.6; }
}

@keyframes stone-glow {
    0%, 100% { box-shadow: 0 10px 15px rgba(78, 46, 66, 0.18); }
    50% { box-shadow: 0 14px 22px rgba(78, 46, 66, 0.28); }
}

@keyframes flicker-warm {
    0% { background: radial-gradient(circle, #ffcf66 0%, #ffb347 60%, rgba(255, 179, 71, 0.2) 100%); box-shadow: 0 0 15px 3px rgba(255, 180, 90, 0.7); }
    50% { background: radial-gradient(circle, #ffd978 0%, #ffc161 60%, rgba(255, 193, 97, 0.25) 100%); box-shadow: 0 0 26px 10px rgba(255, 193, 97, 0.65); }
    100% { background: radial-gradient(circle, #ffcf66 0%, #ffb347 60%, rgba(255, 179, 71, 0.2) 100%); box-shadow: 0 0 18px 5px rgba(255, 180, 90, 0.6); }
}

/* --- Floating Islands Theme --- */
#floating-islands-theme {
    background: linear-gradient(to top, #0f3460, #16213e, #1a1a2e);
    overflow: hidden;
    perspective: 1000px; /* Create a 3D space */
}

#floating-islands-container {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    transform-style: preserve-3d; /* Enable 3D positioning for children */
}

/* Wrapper for each island to handle its position and slow drift */
.floating-island-wrapper {
    position: absolute;
    transform-style: preserve-3d;
    animation: island-drift linear infinite;
}

@keyframes island-drift {
    0% { transform: translate3d(var(--x-start), var(--y-start), var(--z-start)); }
    100% { transform: translate3d(var(--x-end), var(--y-end), var(--z-end)); }
}

/* The island itself, containing the canvas, handles rotation and bobbing */
.floating-island {
    width: 100%; height: 100%;
    filter: drop-shadow(0 10px 15px rgba(0,0,0,0.4));
    animation:
        island-bob 12s ease-in-out infinite alternate,
        island-rotate linear infinite;
}

@keyframes island-bob {
    from { transform: translateY(-8px); }
    to { transform: translateY(8px); }
}

@keyframes island-rotate {
    from { transform: rotateY(0deg); }
    to { transform: rotateY(360deg); }
}

/* Clouds for parallax depth */
#floating-islands-clouds {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 3; /* Between island layers */
    pointer-events: none;
}

.floating-island-cloud {
    position: absolute;
    background: #2d4a7c;
    border-radius: 50%;
    filter: blur(30px);
    animation: cloud-drift linear infinite;
}

@keyframes cloud-drift {
    from { transform: translateX(-20vw); }
    to { transform: translateX(120vw); }
}

/* Energy bridges connecting islands */
#floating-islands-bridges {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 5;
    transform-style: preserve-3d;
}

.energy-bridge {
    position: absolute;
    height: 3px;
    background: linear-gradient(to right, transparent, #b19cd9, #e1bee7, #b19cd9, transparent);
    border-radius: 3px;
    box-shadow: 0 0 10px #e1bee7;
    animation: pulse-bridge 6s ease-in-out infinite;
    transform-origin: center;
}

@keyframes pulse-bridge {
    0%, 100% { filter: brightness(1); }
    50% { filter: brightness(2.5); }
}

/* Serpentine auroras weaving through space */
#floating-aurora {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 2; /* Behind most islands */
    mix-blend-mode: screen;
    filter: blur(20px);
    transform-style: preserve-3d;
}

.aurora-serpent {
    position: absolute;
    width: 100%;
    height: 150px;
    background: linear-gradient(to bottom, transparent, var(--aurora-color, #80cbc4), transparent);
    border-radius: 50%;
    animation: weave-serpent 35s cubic-bezier(0.45, 0, 0.55, 1) infinite alternate;
}

@keyframes weave-serpent {
    from { transform: translate3d(var(--x-start), var(--y-start), var(--z-start)) rotate(var(--r-start)) skewX(30deg); opacity: 0.8; }
    to { transform: translate3d(var(--x-end), var(--y-end), var(--z-end)) rotate(var(--r-end)) skewX(-30deg); opacity: 0.8; }
}


@keyframes particle-drift {
    from {
        transform: translate(var(--x-start), var(--y-start));
        opacity: 0;
    }
    50% {
        opacity: 0.9;
    }
    to {
        transform: translate(var(--x-end), var(--y-end));
        opacity: 0;
    }
}
